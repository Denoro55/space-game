!function(t){var e={};function n(o){if(e[o])return e[o].exports;var i=e[o]={i:o,l:!1,exports:{}};return t[o].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=t,n.c=e,n.d=function(t,e,o){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:o})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(o,i,function(e){return t[e]}.bind(null,i));return o},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="dist",n(n.s=4)}([function(t,e,n){var o=n(1),i=n(2);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[t.i,i,""]]);var r={insert:"head",singleton:!1},a=(o(i,r),i.locals?i.locals:{});t.exports=a},function(t,e,n){"use strict";var o,i=function(){return void 0===o&&(o=Boolean(window&&document&&document.all&&!window.atob)),o},r=function(){var t={};return function(e){if(void 0===t[e]){var n=document.querySelector(e);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(t){n=null}t[e]=n}return t[e]}}(),a=[];function s(t){for(var e=-1,n=0;n<a.length;n++)if(a[n].identifier===t){e=n;break}return e}function l(t,e){for(var n={},o=[],i=0;i<t.length;i++){var r=t[i],l=e.base?r[0]+e.base:r[0],c=n[l]||0,u="".concat(l," ").concat(c);n[l]=c+1;var p=s(u),h={css:r[1],media:r[2],sourceMap:r[3]};-1!==p?(a[p].references++,a[p].updater(h)):a.push({identifier:u,updater:v(h,e),references:1}),o.push(u)}return o}function c(t){var e=document.createElement("style"),o=t.attributes||{};if(void 0===o.nonce){var i=n.nc;i&&(o.nonce=i)}if(Object.keys(o).forEach((function(t){e.setAttribute(t,o[t])})),"function"==typeof t.insert)t.insert(e);else{var a=r(t.insert||"head");if(!a)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");a.appendChild(e)}return e}var u,p=(u=[],function(t,e){return u[t]=e,u.filter(Boolean).join("\n")});function h(t,e,n,o){var i=n?"":o.media?"@media ".concat(o.media," {").concat(o.css,"}"):o.css;if(t.styleSheet)t.styleSheet.cssText=p(e,i);else{var r=document.createTextNode(i),a=t.childNodes;a[e]&&t.removeChild(a[e]),a.length?t.insertBefore(r,a[e]):t.appendChild(r)}}function f(t,e,n){var o=n.css,i=n.media,r=n.sourceMap;if(i?t.setAttribute("media",i):t.removeAttribute("media"),r&&btoa&&(o+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(r))))," */")),t.styleSheet)t.styleSheet.cssText=o;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(o))}}var y=null,d=0;function v(t,e){var n,o,i;if(e.singleton){var r=d++;n=y||(y=c(e)),o=h.bind(null,n,r,!1),i=h.bind(null,n,r,!0)}else n=c(e),o=f.bind(null,n,e),i=function(){!function(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t)}(n)};return o(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap)return;o(t=e)}else i()}}t.exports=function(t,e){(e=e||{}).singleton||"boolean"==typeof e.singleton||(e.singleton=i());var n=l(t=t||[],e);return function(t){if(t=t||[],"[object Array]"===Object.prototype.toString.call(t)){for(var o=0;o<n.length;o++){var i=s(n[o]);a[i].references--}for(var r=l(t,e),c=0;c<n.length;c++){var u=s(n[c]);0===a[u].references&&(a[u].updater(),a.splice(u,1))}n=r}}}},function(t,e,n){(e=n(3)(!1)).push([t.i,"canvas {\r\n  background: black; }\r\n",""]),t.exports=e},function(t,e,n){"use strict";t.exports=function(t){var e=[];return e.toString=function(){return this.map((function(e){var n=function(t,e){var n=t[1]||"",o=t[3];if(!o)return n;if(e&&"function"==typeof btoa){var i=(a=o,s=btoa(unescape(encodeURIComponent(JSON.stringify(a)))),l="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(s),"/*# ".concat(l," */")),r=o.sources.map((function(t){return"/*# sourceURL=".concat(o.sourceRoot||"").concat(t," */")}));return[n].concat(r).concat([i]).join("\n")}var a,s,l;return[n].join("\n")}(e,t);return e[2]?"@media ".concat(e[2]," {").concat(n,"}"):n})).join("")},e.i=function(t,n,o){"string"==typeof t&&(t=[[null,t,""]]);var i={};if(o)for(var r=0;r<this.length;r++){var a=this[r][0];null!=a&&(i[a]=!0)}for(var s=0;s<t.length;s++){var l=[].concat(t[s]);o&&i[l[0]]||(n&&(l[2]?l[2]="".concat(n," and ").concat(l[2]):l[2]=n),e.push(l))}},e}},function(t,e,n){"use strict";n.r(e);n(0);function o(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}var i=function(){function t(e,n,o){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.states={},this.activeState=null,this.canvas=e,this.ctx=this.canvas.getContext("2d"),this.gameWidth=this.canvas.width,this.gameHeight=this.canvas.height,this.maps=n,this.currentLevel=0,this.config=o}var e,n,i;return e=t,(n=[{key:"addState",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this.states[t]=new e(n)}},{key:"runState",value:function(t){this.activeState=t,this.run()}},{key:"changeState",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.activeState=t,this.states[this.activeState].create(this,e)}},{key:"setCurrentLevel",value:function(t){this.currentLevel=t}},{key:"run",value:function(){var t=this;this.states[this.activeState].create(this),function e(){t.ctx.clearRect(0,0,t.gameWidth,t.gameHeight);var n=performance.now();t.states[t.activeState].update(t),t.states[t.activeState].render(t),n=performance.now()-n,t.config.scriptTime&&console.log("Время выполнения = ",n),window.requestAnimationFrame(e)}()}}])&&o(e.prototype,n),i&&o(e,i),t}(),r="#1b00ff",a="white",s="#00ff08",l="green",c="square",u="circle",p="polygon";function h(t,e){this.x=t,this.y=e}h.prototype.add=function(t){return new h(this.x+t.x,this.y+t.y)},h.prototype.down=function(t){return new h(this.x-Math.sign(this.x)*t,this.y-Math.sign(this.y)*t)};var f=h;function y(t,e){var n=t.x-e.x,o=t.y-e.y;return Math.atan2(o,n)}function d(t){return t/Math.PI*180}function v(t){return t*Math.PI/180}function m(t,e){var n=g(t),o=n.width,i=n.height,r=o/2,a=i/2;return t.map((function(t){var n=t[0],o=t[1];return[r+(n-r)*Math.cos(e)-(o-a)*Math.sin(e),a+(n-r)*Math.sin(e)+(o-a)*Math.cos(e)]}))}function b(t,e){var n=g(t),o=n.width,i=n.height;return{x:e.x+.5-o/2,y:e.y+.5-i/2}}function g(t){var e=0,n=0;return t.forEach((function(t){t[0]>e&&(e=t[0]),t[1]>n&&(n=t[1])})),{width:e,height:n}}function w(t,e,n,o){var i=n.x-t.x,r=n.y-t.y,a=o.x-t.x-i,s=o.y-t.y-r,l=a*a+s*s,c=2*(i*a+r*s),u=i*i+r*r-e*e;return-c<0?u<0:-c<2*l?4*l*u-c*c<0:l+c+u<0}function S(t,e){return new f(Math.floor(Math.random()*(t+1)),Math.floor(Math.random()*(e+1)))}function x(t,e){return new f(t*Math.cos(e),t*Math.sin(e))}function O(t,e,n){return new f(t.x+n*Math.cos(e),t.y+n*Math.sin(e))}function k(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}var P=function(){function t(e){var n=e.pos,o=e.speed,i=e.size,a=e.color,s=e.name,l=e.strokeWidth,c=e.style,u=e.alpha;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.pos=n,this.speed=o||new f(0,0),this.size=i||new f(1,1),this.color=a||r,this.name=s||"",this.alpha=void 0!==u?u:1,this.options={strokeWidth:l||2,style:c||"stroke"}}var e,n,o;return e=t,(n=[{key:"act",value:function(t){var e=this;if(this.pos=this.pos.add(this.speed),this.pos.x>t.screenWidth+3||this.pos.x<-3||this.pos.y<-3||this.pos.y>t.screenHeight+3){if("boss"===this.name)return;t.actors=t.actors.filter((function(t){return t!==e}))}}}])&&k(e.prototype,n),o&&k(e,o),t}();function T(t){return(T="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function j(t,e){return!e||"object"!==T(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function M(t){return(M=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function _(t,e){return(_=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var z=function(t){function e(t){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=j(this,M(e).call(this,t))).shape=u,n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&_(t,e)}(e,t),e}(P);function E(t){return(E="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function A(t,e){return!e||"object"!==E(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function R(t){return(R=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function W(t,e){return(W=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var I=function(t){function e(t){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=A(this,R(e).call(this,t))).shape=c,n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&W(t,e)}(e,t),e}(P);function C(t){return(C="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function B(t,e){return!e||"object"!==C(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function D(t){return(D=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function H(t,e){return(H=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var L=function(t){function e(t){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=B(this,D(e).call(this,t))).points=t.points||[[0,0],[40,40],[0,40],[0,0]],n.shape=p,n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&H(t,e)}(e,t),e}(P);function N(t){return(N="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function F(t,e){return!e||"object"!==N(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function q(t){return(q=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function K(t,e){return(K=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var U=function(t){function e(t){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=F(this,q(e).call(this,t))).damage=t.damage,n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&K(t,e)}(e,t),e}(z);function J(t){return(J="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function V(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function X(t,e){return!e||"object"!==J(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function Y(t,e,n){return(Y="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var o=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=G(t)););return t}(t,e);if(o){var i=Object.getOwnPropertyDescriptor(o,e);return i.get?i.get.call(n):i.value}})(t,e,n||t)}function G(t){return(G=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Q(t,e){return(Q=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var Z=function(t){function e(t){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=X(this,G(e).call(this,t))).damage=t.damage||1,n.states=t.states||[],n.angle=t.angle||0,n.shape=t.shape||u,n.shapeOptions=t.shapeOptions||{},n.activeStateIndex=0,n.currentStateIndex=null,n}var n,o,i;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Q(t,e)}(e,t),n=e,(o=[{key:"act",value:function(t){var n=this.states[this.activeStateIndex];Y(G(e.prototype),"act",this).call(this,t),n&&(this.currentStateIndex!==this.activeStateIndex&&this.activateState(this.activeStateIndex,n,t),n.options&&(n.options.size&&this.size.x<n.options.size.maxSize&&(this.size=new f(this.size.x+n.options.size.value,this.size.y+n.options.size.value)),n.options.alpha&&this.alpha<n.options.alpha.target&&(this.alpha=Math.min(this.alpha+n.options.alpha.value,1))),void 0!==n.timer&&n.timer>0?n.timer-=1:this.activeStateIndex+=1)}},{key:"activateState",value:function(t,e,n){switch(this.currentStateIndex=t,e.type){case"changeDir":if(e.dir)this.angle=e.dir;else{var o,i=n.actors.filter((function(t){return t instanceof pt}))[0];if(e.spreadAngle){var r=-e.spreadAngle+Math.random()*(2*e.spreadAngle);o=y(i.pos,this.pos)+v(r)}else o=y(i.pos,this.pos);this.angle=o}break;case"changeSpeed":this.speed=new f(e.speed*Math.cos(this.angle),e.speed*Math.sin(this.angle));break;case"stop":this.speed=new f(0,0);break;case"explode":n.destroyActor(this),n.createSparkles({count:7,spread:11,pos:this.pos,color:a});for(var s=60*Math.random(),l=0;l<6;l++){var c=v(60*l+s);n.actors.push(new Z({pos:new f(this.pos.x,this.pos.y),speed:new f(.17*Math.cos(c),.17*Math.sin(c)),color:this.color,size:new f(.2,.2),name:"enemyBullet",damage:5}))}}}}])&&V(n.prototype,o),i&&V(n,i),e}(P);function $(t){return($="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function tt(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function et(t,e){return!e||"object"!==$(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function nt(t,e,n){return(nt="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var o=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=ot(t)););return t}(t,e);if(o){var i=Object.getOwnPropertyDescriptor(o,e);return i.get?i.get.call(n):i.value}})(t,e,n||t)}function ot(t){return(ot=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function it(t,e){return(it=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var rt=function(t){function e(t,n){var o;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(o=et(this,ot(e).call(this,t))).size=new f(2,2),o.name="boss",o.damage=1,o.angle=0,o.shape=u,o.color=n.params.boss.color,o.maxHp=t.maxHp||250,o.hp=o.maxHp,o.difficult=0,o.difficultRanges=[60,30,0],o}var n,o,i;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&it(t,e)}(e,t),n=e,(o=[{key:"updateDifficult",value:function(){for(var t=0;t<this.difficultRanges.length;t++)this.hp>this.difficultRanges[t]&&(this.difficult=t)}},{key:"act",value:function(t){var n=t.actorAt(this,{name:"playerBullet"});n&&(t.actors=t.actors.filter((function(t){return t!==n})),this.hp-=n.damage,this.updateDifficult(),t.createSparkles({count:7,spread:11,pos:n.pos,color:a}),this.hp<=0&&this.destroy(t)),nt(ot(e.prototype),"act",this).call(this,t)}}])&&tt(n.prototype,o),i&&tt(n,i),e}(P);function at(t){return(at="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function st(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function lt(t){return(lt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function ct(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function ut(t,e){return(ut=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var pt=function(t){function e(t,n){var o,i,r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),i=this,(o=!(r=lt(e).call(this,t))||"object"!==at(r)&&"function"!=typeof r?ct(i):r).size=new f(.65,.65),o.speed=new f(.12,.12),o.shape=u,o.color=s,o.maxHp=100,o.hp=o.maxHp,o.reloadTime=20,o.shootTime=0,o.bulletSpeed=.19,n.player=ct(o),o}var n,o,i;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&ut(t,e)}(e,t),n=e,(o=[{key:"act",value:function(t,e){var n=t.actorAt(this);n&&("enemyBullet"===n.name?(t.actors=t.actors.filter((function(t){return t!==n})),this.hp-=n.damage,t.createSparkles({count:7,spread:11,pos:n.pos,color:a})):n instanceof rt&&(this.hp-=n.damage),this.hp<=0&&t.fail());var o=1;if((e.right&&e.down||e.right&&e.up||e.left&&e.down||e.left&&e.up)&&(o=.8),e.right&&this.pos.x<t.screenWidth-1&&(this.pos.x+=this.speed.x*o),e.left&&this.pos.x>0&&(this.pos.x-=this.speed.x*o),e.up&&this.pos.y>0&&(this.pos.y-=this.speed.y*o),e.down&&this.pos.y<t.screenHeight-1&&(this.pos.y+=this.speed.y*o),this.shootTime>0&&(this.shootTime-=1),e.mouseDown&&this.shootTime<=0){var i=y(new f(e.mouse.x/t.cellSize,e.mouse.y/t.cellSize),this.pos);t.createActor(new U({name:"playerBullet",pos:new f(this.pos.x,this.pos.y),speed:new f(this.bulletSpeed*Math.cos(i),this.bulletSpeed*Math.sin(i)),color:l,size:new f(.15,.15),damage:1})),this.shootTime=this.reloadTime}}}])&&st(n.prototype,o),i&&st(n,i),e}(P);function ht(t){return(ht="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ft(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function yt(t,e){return!e||"object"!==ht(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function dt(t){return(dt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function vt(t,e){return(vt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var mt=function(t){function e(t){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=yt(this,dt(e).call(this,t))).shape=t.shape,n.maxTime=20,n.time=n.maxTime,n}var n,o,i;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&vt(t,e)}(e,t),n=e,(o=[{key:"update",value:function(t){var e=this;this.time>0?(this.time-=1,this.speed=this.speed.down(.004),this.alpha=this.time/this.maxTime):t.effects=t.effects.filter((function(t){return t!==e}))}}])&&ft(n.prototype,o),i&&ft(n,i),e}(P);function bt(t){return(bt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function gt(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function wt(t,e){return!e||"object"!==bt(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function St(t){return(St=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function xt(t,e){return(xt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var Ot=function(t){function e(t){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=wt(this,St(e).call(this,t))).shape=c,n.alpha=0,n.sign=0,n.rotation=t.rotation||0,n.startPos=n.pos,n.delay=t.delay,n}var n,o,i;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&xt(t,e)}(e,t),n=e,(o=[{key:"update",value:function(t){if(this.delay>0)this.delay-=1;else{this.rotation+=4;var e=Math.sin(this.rotation/100);this.alpha=Math.abs(e);var n=Math.sign(e);this.size=new f(.16*this.alpha,.16*this.alpha),this.pos=new f(this.startPos.x-.08*this.alpha,this.startPos.y-.08*this.alpha),Math.sign(e)!==this.sign&&(this.startPos=S(t.screenWidth,t.screenHeight)),this.sign=n}}}])&&gt(n.prototype,o),i&&gt(n,i),e}(P);function kt(t){return(kt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Pt(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function Tt(t,e){return!e||"object"!==kt(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function jt(t){return(jt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Mt(t,e){return(Mt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var _t=function(t){function e(t){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=Tt(this,jt(e).call(this,t))).shape=t.shape||u,n.updateFunc=t.updateFunc||null,n.alphaTransitionSpeed=.007,n.alive=!0,n.reloadTime=30,n.time=n.reloadTime,n.activeWeapon=t.type||0,n.currentWeapon=null,n.appearedTimer=100,n}var n,o,i;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Mt(t,e)}(e,t),n=e,(o=[{key:"update",value:function(t){var e=this;if(this.updateFunc&&this.updateFunc(),this.activeWeapon!==this.currentWeapon&&this.activateWeapon(this.activeWeapon),this.alive)if(this.appearedTimer>0)this.appearedTimer-=1;else if(this.time>0)this.time-=1;else{switch(this.activeWeapon){case 0:t.createActor(new Z({pos:new f(this.pos.x,this.pos.y),color:this.color,size:new f(.4,.4),name:"enemyBullet",damage:30,alpha:.1,states:[{type:"changeDir"},{type:"changeSpeed",speed:.15},{type:"waiting",timer:30+35*Math.random(),options:{size:{value:.01,maxSize:1},alpha:{value:.02,target:1}}},{type:"stop",timer:25},{type:"explode"}]}));break;case 1:t.createActor(new Z({pos:new f(this.pos.x,this.pos.y),color:this.color,size:new f(.3,.3),name:"enemyBullet",damage:10,alpha:.1,states:[{type:"changeDir",spreadAngle:38},{type:"changeSpeed",speed:.2},{type:"waiting",timer:50,options:{alpha:{value:.02,target:1}}}]}))}this.time=this.reloadTime}else this.alpha=Math.max(this.alpha-this.alphaTransitionSpeed,0),this.alpha<=0&&(t.effects=t.effects.filter((function(t){return t!==e})))}},{key:"activateWeapon",value:function(t){switch(this.currentWeapon=t,t){case 0:this.reloadTime=30,this.time=this.reloadTime;break;case 1:this.reloadTime=10,this.time=this.reloadTime}}},{key:"updateAlpha",value:function(t){this.alpha<t&&(this.alpha+=.004),this.alpha>t&&(this.alpha=t)}},{key:"destroy",value:function(){this.alive=!1}}])&&Pt(n.prototype,o),i&&Pt(n,i),e}(P);function zt(t){return(zt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Et(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function At(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Rt(t,e,n){return(Rt="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var o=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Wt(t)););return t}(t,e);if(o){var i=Object.getOwnPropertyDescriptor(o,e);return i.get?i.get.call(n):i.value}})(t,e,n||t)}function Wt(t){return(Wt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function It(t,e){return(It=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Ct(t){return(Ct="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Bt(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if(!(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t)))return;var n=[],o=!0,i=!1,r=void 0;try{for(var a,s=t[Symbol.iterator]();!(o=(a=s.next()).done)&&(n.push(a.value),!e||n.length!==e);o=!0);}catch(t){i=!0,r=t}finally{try{o||null==s.return||s.return()}finally{if(i)throw r}}return n}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function Dt(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function Ht(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function Lt(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Nt(t,e,n){return(Nt="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var o=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Ft(t)););return t}(t,e);if(o){var i=Object.getOwnPropertyDescriptor(o,e);return i.get?i.get.call(n):i.value}})(t,e,n||t)}function Ft(t){return(Ft=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function qt(t,e){return(qt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var Kt={offset:2.2,speed:.12,damage:10},Ut={speed:.15},Jt={multipleShooting:"stateMultipleShooting",moving:"stateMoving",simpleShooting:"stateSimpleShooting",doubleShooting:"stateDoubleShooting",splashShooting:"stateSplashShooting",clone:"stateClone"};function Vt(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function Xt(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var Yt,Gt,Qt,Zt,$t={x:"wall",o:"coin"},te={0:function(t){function e(t,n){var o,i,r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),i=this,(o=!(r=Wt(e).call(this,t,n))||"object"!==zt(r)&&"function"!=typeof r?At(i):r).reloadTime=35,o.shootTime=o.reloadTime,o.states=[{bullets:0,nextState:[0,1,2,4]},{bullets:0,bulletPositions:[],nextState:[0,1,2,4]},{stopTime:200,nextState:[3,3,3,4]},{pointPosition:new f(0,0),nextState:[0,1]},{pointPosition:new f(0,0),timer:-1,startTimer:15,waves:15,nextState:[0,1,2]}],o.activeStateIndex=0,o.currentStateIndex=null,o.weapons={left:{active:!1,type:0,weapon:null},right:{active:!1,type:0,weapon:null}},o.bulletOptions={offset:1.9,speed:.12,damage:10},o.delay=0,o.alpha=1,o.alphaTransitionSpeed=.004,o.maxSpeed=.06,o.visibility=!0,n.boss=At(o),o}var n,o,i;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&It(t,e)}(e,t),n=e,(o=[{key:"act",value:function(t){this.activeStateIndex!==this.currentStateIndex&&this.activateState(this.activeStateIndex,t);var n=this.states[this.activeStateIndex];if(this.changeAlpha(this.visibility),this.delay>0)this.delay-=1;else switch(this.shootTime>0&&(this.shootTime-=1),this.activeStateIndex){case 0:if(this.shootTime<=0){this.shootTime=this.reloadTime;var o=y(t.player.pos,this.pos);t.actors.push(new Z({pos:new f(this.pos.x+this.bulletOptions.offset*Math.cos(o),this.pos.y+this.bulletOptions.offset*Math.sin(o)),color:this.color,size:new f(.15,.15),name:"enemyBullet",alpha:.1,damage:this.bulletOptions.damage,angle:o,states:[{type:"stop",timer:45,options:{size:{value:.01,maxSize:.7},alpha:{value:.03,target:1}}},{type:"changeDir",target:"player"},{type:"changeSpeed",speed:this.bulletOptions.speed}]})),n.bullets-=1}n.bullets<=0&&this.nextState(t);break;case 1:if(this.shootTime<=0&&n.bulletPositions.length>0){var i=45*n.bulletPositions.shift()*Math.PI/180;t.actors.push(new Z({pos:new f(this.pos.x+this.bulletOptions.offset*Math.cos(i),this.pos.y+this.bulletOptions.offset*Math.sin(i)),color:this.color,size:new f(.15,.15),name:"enemyBullet",damage:this.bulletOptions.damage,states:[{type:"stopped",timer:50,options:{size:{value:.01,maxSize:.7}}},{type:"changeDir",target:"player",spreadAngle:50},{type:"changeSpeed",speed:this.bulletOptions.speed}]})),this.shootTime=this.reloadTime}n.bulletPositions.length<=0&&this.nextState(t);break;case 2:this.moveToPoint(t.player.pos),this.shootTime<=0&&(this.makeFloatingBullet(t),this.shootTime=this.reloadTime),n.stopTime>0?n.stopTime-=1:this.nextState(t);break;case 3:this.moveToPoint(n.pointPosition),this.shootTime<=0&&(this.makeFloatingBullet(t),this.shootTime=this.reloadTime),Math.sqrt(Math.pow(this.pos.x-n.pointPosition.x,2)+Math.pow(this.pos.y-n.pointPosition.y,2))<35*this.maxSpeed&&this.nextState(t);break;case 4:if(this.moveToPoint(n.pointPosition),Math.sqrt(Math.pow(this.pos.x-n.pointPosition.x,2)+Math.pow(this.pos.y-n.pointPosition.y,2))<35*this.maxSpeed)if(this.speed=new f(0,0),n.timer<0){n.timer=n.startTimer;var r=this.getPercentHealth()<50?12:8;n.bulletPositions=this.fillBullets(r),this.makeWave(n,t),n.waves-=1}else n.timer-=1;n.waves<=0&&this.nextState(t)}Rt(Wt(e.prototype),"act",this).call(this,t)}},{key:"makeWave",value:function(t,e){var n,o,i=30*Math.random();this.getPercentHealth()<50?(n=12,o=30):(n=8,o=45);for(var r=0;r<n;r++){var a=(i+t.bulletPositions.shift()*o)*Math.PI/180;e.actors.push(new Z({pos:new f(this.pos.x+this.bulletOptions.offset*Math.cos(a),this.pos.y+this.bulletOptions.offset*Math.sin(a)),color:this.color,size:new f(.2,.2),name:"enemyBullet",alpha:.1,damage:this.bulletOptions.damage,states:[{type:"stopped",timer:25,options:{size:{value:.01,maxSize:.7},alpha:{value:.04,target:1}}},{type:"changeDir",dir:a},{type:"changeSpeed",speed:this.bulletOptions.speed}]}))}}},{key:"makeFloatingBullet",value:function(t){t.actors.push(new Z({pos:new f(this.pos.x,this.pos.y),color:this.color,size:new f(.15,.15),name:"enemyBullet",damage:this.bulletOptions.damage,states:[{type:"stopped",timer:150+500*Math.random(),options:{size:{value:.01,maxSize:.7}}},{type:"changeDir",target:"player",spreadAngle:25},{type:"changeSpeed",speed:this.bulletOptions.speed}]}))}},{key:"moveToPoint",value:function(t){this.pos.x<t.x?this.speed=new f(Math.min(this.speed.x+.002,this.maxSpeed),this.speed.y):this.pos.x>t.x&&(this.speed=new f(Math.max(this.speed.x-.002,-this.maxSpeed),this.speed.y)),this.pos.y<t.y?this.speed=new f(this.speed.x,Math.min(this.speed.y+.002,this.maxSpeed)):this.pos.y>t.y&&(this.speed=new f(this.speed.x,Math.max(this.speed.y-.002,-this.maxSpeed)))}},{key:"fillBullets",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:8,e=[],n=0;n<t;n++)e.push(n);return e.sort((function(){return Math.random()-.5}))}},{key:"nextState",value:function(t){var e=this.states[this.activeStateIndex],n=Math.floor(Math.random()*e.nextState.length);this.activateState(e.nextState[n],t)}},{key:"getCoordsWeapon",value:function(t,e){var n="left"===t?-90:90,o=v(d(y(e.actors.filter((function(t){return t instanceof pt}))[0].pos,this.pos))+n);return new f(this.pos.x+this.bulletOptions.offset*Math.cos(o),this.pos.y+this.bulletOptions.offset*Math.sin(o))}},{key:"getAlpha",value:function(){return this.alpha}},{key:"activateWeapon",value:function(t,e){if(!this.weapons[t].active){var n=this,o=new _t({pos:new f(this.pos.x,this.pos.y),color:this.color,size:new f(.7,.7),alpha:0,shape:u,type:Math.floor(2*Math.random()),updateFunc:function(){this.pos=n.getCoordsWeapon(t,e),this.updateAlpha(n.getAlpha())}});this.weapons[t].active=!0,this.weapons[t].weapon=o,e.effects.push(o)}}},{key:"disableWeapon",value:function(t){this.weapons[t].active&&(this.weapons[t].active=!1,this.weapons[t].weapon.destroy())}},{key:"changeAlpha",value:function(t){this.alpha=t?Math.min(this.alpha+this.alphaTransitionSpeed,1):Math.max(this.alpha-this.alphaTransitionSpeed,0)}},{key:"randomizeVisibility",value:function(){this.visibility=Math.random()<.5}},{key:"getPercentHealth",value:function(){return 100*this.hp/this.maxHp}},{key:"activateState",value:function(t,e){this.activeStateIndex=t,this.currentStateIndex=t;var n=this.states[t],o=this.getPercentHealth();switch(this.disableWeapon("left",e),this.disableWeapon("right",e),this.randomizeVisibility(),o<50&&(this.maxSpeed=.09),t){case 0:n.bullets=o<50?8+6*Math.random():4+6*Math.random(),this.delay=50,this.reloadTime=35,Math.random()<1-o/100+.4&&this.activateWeapon("left",e),Math.random()<1-o/100+.4&&this.activateWeapon("right",e),this.speed=new f(0,0);break;case 1:n.bulletPositions=this.fillBullets(),this.reloadTime=10,this.delay=50,this.shootTime=this.reloadTime;break;case 2:var i=y(e.actors.filter((function(t){return t instanceof pt}))[0].pos,this.pos);this.speed=new f(.03*Math.cos(i),.03*Math.sin(i)),this.shootTime=this.reloadTime,n.stopTime=400,this.visibility=!1,o>50?this.reloadTime=40:o<=50&&o>25?(this.reloadTime=25,Math.random()<.5&&this.activateWeapon("right",e)):(this.reloadTime=25,Math.random()<.5&&this.activateWeapon("right",e),Math.random()<.5&&this.activateWeapon("left",e));break;case 3:var r=S(e.screenWidth-6,e.screenHeight-6);n.pointPosition=new f(3+r.x,3+r.y);break;case 4:n.pointPosition=new f(e.screenWidth/2,e.screenHeight/2),n.waves=Math.floor(15+10*Math.random())}}},{key:"destroy",value:function(t){t.win({text:"Вы победили Призрака!"}),t.destroyActor(this)}}])&&Et(n.prototype,o),i&&Et(n,i),e}(rt),1:function(t){function e(t,n){var o,i,r,a;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),r=this,a=Ft(e).call(this,t,n),(i=!a||"object"!==Ct(a)&&"function"!=typeof a?Lt(r):a).states=(Dt(o={},Jt.multipleShooting,{time:200,reloadTime:{bullet:8,full:100},timer:{bullet:35,full:0},bulletsLimit:18,bullets:18,additionalStates:[],options:{times:1}}),Dt(o,Jt.simpleShooting,{time:200,reloadTime:{bullet:20},timer:{bullet:35},additionalStates:[],options:{times:1}}),Dt(o,Jt.moving,{time:200,active:!1,limit:300,point:new f(0,0),angle:0,rot:null,additionalStates:[Jt.simpleShooting],options:{times:1}}),Dt(o,Jt.clone,{time:0,onlyRoot:!0,active:!1,additionalStates:[],nextStateName:Jt.moving,options:{times:4,condition:function(){return i.clones.length<1+i.difficult}}}),Dt(o,Jt.doubleShooting,{time:200,reloadTime:{bullet:11},timer:{bullet:35},additionalStates:[],options:{times:1}}),Dt(o,Jt.splashShooting,{time:100,reloadTime:{bullet:25},timer:{bullet:35},bullets:8,bulletRange:12,bulletTimeout:50,additionalStates:[],options:{times:1}}),o),i.clone=t.clone||!1,i.clones=[],i.setNewMovingPoint=i.setNewMovingPoint.bind(Lt(i),n),i.stateKeys=i.getStatesKeys(),i.currentStates=i.clone?[Jt.moving]:[Jt.multipleShooting],i.currentMainState=i.currentStates[0],i.timeToNextState=100,i.clone||(n.boss=Lt(i)),i}var n,o,i;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&qt(t,e)}(e,t),n=e,(o=[{key:"act",value:function(t){var n=this;this.currentStates.forEach((function(e){var o=n.states[e];n[e](t,o)})),this.timeToNextState>0?this.timeToNextState-=1:this.nextState(),Nt(Ft(e.prototype),"act",this).call(this,t),this.clones.forEach((function(e){e.hp<=0&&(n.makeWave(e,t),n.clones=n.clones.filter((function(t){return t!==e})))}))}},{key:Jt.multipleShooting,value:function(t,e){if(e.timer.full>0)e.timer.full-=1;else if(e.bullets>0)if(e.timer.bullet<=0){var n=y(t.player.pos,this.pos);t.actors.push(this.createPolygonBullet(n,40)),e.timer.bullet=e.reloadTime.bullet,e.bullets-=1}else e.timer.bullet-=1;else e.timer.full=e.reloadTime.full,e.bullets=e.bulletsLimit}},{key:Jt.simpleShooting,value:function(t,e){if(e.timer.bullet<=0){var n=y(t.player.pos,this.pos);t.actors.push(this.createPolygonBullet(n,15)),e.timer.bullet=e.reloadTime.bullet}else e.timer.bullet-=1}},{key:Jt.moving,value:function(t,e){e.active?(this.checkDistanceToPoint(e),this.updateAngleToPoint(e)):(e.active=!0,this.setNewMovingPoint(e))}},{key:Jt.clone,value:function(t,n){if(!n.active){n.active=!0;var o=new e({pos:new f(this.pos.x,this.pos.y),clone:!0,maxHp:10},t);this.clones.push(o),t.createActor(o)}}},{key:Jt.doubleShooting,value:function(t,e){var n=this;if(e.timer.bullet<=0){var o=y(t.player.pos,this.pos);[90,-90].forEach((function(e){var i=v(d(y(t.player.pos,n.pos))+e);t.actors.push(n.createBullet({angle:o,positionAngle:i,offset:2}))})),e.timer.bullet=e.reloadTime.bullet}else e.timer.bullet-=1}},{key:Jt.splashShooting,value:function(t,e){var n=this;if(e.timer.bullet<=0){for(var o=360*Math.random(),i=function(i){var r=v(o+=e.bulletRange);setTimeout((function(){t.actors.push(n.createBullet({angle:r,positionAngle:r,offset:1.7}))}),i*e.bulletTimeout)},r=0;r<e.bullets;r++)i(r);e.timer.bullet=e.reloadTime.bullet}else e.timer.bullet-=1}},{key:"getStatesKeys",value:function(){var t=this,e=[];return Object.entries(this.states).forEach((function(n){var o=Bt(n,2),i=o[0],r=o[1],a=!0;if(r.options.condition&&(r.options.condition()||(a=!1)),t.clone&&r.onlyRoot&&(a=!1),a)for(var s=0;s<r.options.times;s++)e.push(i)})),e}},{key:"nextState",value:function(){var t,e=this;if(this.currentMainState.nextStateName)t=this.currentMainState.nextStateName;else{var n=Math.floor(Math.random()*this.stateKeys.length);t=this.stateKeys[n]}var o=this.states[t];this.clearStates(t),this.prepareState(t,o),this.currentMainState=o,this.currentStates.push(t),o.additionalStates.forEach((function(t){e.currentStates.push(t)})),this.timeToNextState=o.time,this.stateKeys=this.getStatesKeys()}},{key:"clearStates",value:function(t){var e=this;this.currentStates.forEach((function(n){n!==t&&e.deactivateState(n)})),this.currentStates=[]}},{key:"deactivateState",value:function(t){switch(t){case Jt.moving:this.speed=new f(0,0)}}},{key:"prepareState",value:function(t,e){switch(t){case Jt.clone:e.active=!1}}},{key:"setNewMovingPoint",value:function(t,e){e.point=S(t.screenWidth-6,t.screenHeight-6),e.angle=y(e.point,this.pos)}},{key:"checkDistanceToPoint",value:function(t){var e,n;e=this.pos,n=t.point,Math.sqrt(Math.pow(e.x-n.x,2)+Math.pow(e.y-n.y,2))<2&&this.setNewMovingPoint(t)}},{key:"updateAngleToPoint",value:function(t){var e,n,o,i=v(this.angle),r=d(t.angle);this.speed=x(.06,i),this.angle=(e=this.angle,o=3,e-(n=r)==0?e%360:(Math.abs(e-n)<180?e<n?e+=o:e-=o:e<n?e-=o:e+=o,e%360)),t.angle=y(t.point,this.pos)}},{key:"makeWave",value:function(t,e){(function(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:8,n=arguments.length>2?arguments[2]:void 0,o=[],i=30*Math.random(),r=360/e,a=0;a<e;a++){var s=(i+a*r)*Math.PI/180;o.push(new Z({pos:O(new f(t.x,t.y),s,n.offset),color:n.color,size:new f(.35,.35),name:"enemyBullet",angle:s,alpha:1,speed:x(n.speed,s),damage:n.damage,states:[]}))}return o})(t.pos,14,{damage:Kt.damage,offset:.5,color:this.color,speed:Kt.speed}).forEach((function(t){e.actors.push(t)}))}},{key:"createPolygonBullet",value:function(t,e){var n,o,i=function(t,e){return t.map((function(t){return[t[0]*e,t[1]*e]}))}([[0,0],[1,.5],[0,1],[.25,.5],[0,0]],.5),r=function(t,e){return t+v(-e+Math.random()*(2*e))}(t,e);return new Z({pos:O(b(i,this.pos),r,1.8),color:this.color,size:new f(.15,.15),name:"enemyBullet",alpha:1,damage:Kt.damage,angle:r,speed:x((n=Kt.speed,o=.06,n+Math.random()*o),r),shape:p,shapeOptions:{points:m(i,r)},states:[]})}},{key:"createBullet",value:function(t){return new Z({pos:O(this.pos,t.positionAngle,t.offset),color:this.color,size:new f(.3,.3),name:"enemyBullet",alpha:1,damage:Kt.damage,angle:t.angle,speed:x(Ut.speed,t.angle),states:[]})}},{key:"updateDifficult",value:function(){if(!this.clone)for(var t,e,n=(t=this.hp,e=this.maxHp,100*t/e),o=0;o<this.difficultRanges.length;o++)if(n>this.difficultRanges[o]){this.difficult=o;break}}},{key:"destroy",value:function(t){this.clone||t.win({text:"Вы победили Иллюзиониста!"}),t.destroyActor(this)}}])&&Ht(n.prototype,o),i&&Ht(n,i),e}(rt)},ee={"@":function(t,e,n){return new pt({pos:new f(t,e)},n)},s:function(t,e,n){return new I({pos:new f(t,e)},n)},c:function(t,e,n){return new z({pos:new f(t,e)},n)},p:function(t,e,n){return new L({pos:new f(t,e)},n)},B:function(t,e,n){return new te[n.levelIndex]({pos:new f(t,e)},n)}},ne=(Yt={37:"left",38:"up",39:"right",40:"down",87:"up",68:"right",65:"left",83:"down"},Gt={},Qt=function(t){Yt.hasOwnProperty(t.keyCode)&&(Gt[Yt[t.keyCode]]="keydown"===t.type,t.preventDefault())},Zt=function(t){"mousedown"===t.type&&(Gt.mouseDown=!0),"mouseup"===t.type&&(Gt.mouseDown=!1),Gt.mouse=new f(t.clientX-10,t.clientY-10)},addEventListener("keydown",Qt),addEventListener("keyup",Qt),document.onmousedown=Zt,document.onmouseup=Zt,document.onmousemove=Zt,Gt);function oe(t,e,n,o,i){this.game=t,this.cellSize=40,this.width=e[0].length,this.height=e.length,this.screenWidth=1e3/this.cellSize,this.screenHeight=600/this.cellSize,this.grid=[],this.actors=[],this.effects=[],this.levelIndex=n,this.config=o,this.player={},this.boss={},this.params=i;for(var r=0;r<this.height;r++){for(var s=[],l=0;l<this.width;l++){var c=e[r][l];ee[c]&&this.actors.push(ee[c](l,r,this)),s[l]=$t[c]||null}this.grid.push(s)}for(var u=0;u<20;u++)this.effects.push(new Ot({pos:S(this.screenWidth,this.screenHeight),size:new f(0,0),color:a,strokeWidth:1,rotation:0,delay:60*Math.random(),style:"fill"}))}oe.prototype.animate=function(){this.config.debug&&console.log("Actors count: ",this.actors.length,"| Effects count: ",this.effects.length),this.updateActors()},oe.prototype.fail=function(){this.game.changeState("fail",{color:this.boss.color})},oe.prototype.win=function(t){var e=function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Vt(Object(n),!0).forEach((function(e){Xt(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Vt(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}({},t,{color:this.params.boss.color});this.game.changeState("win",e)},oe.prototype.updateActors=function(){var t=this;this.actors.forEach((function(e){e.act(t,ne)})),this.effects.forEach((function(e){e.act(t),e.update(t)}))},oe.prototype.actorAt=function(t,e){for(var n=0;n<this.actors.length;n++){var o=this.actors[n];if((!e||e.name===o.name)&&o!==t)switch(o.shape){case"square":if(t.pos.x+t.size.x>o.pos.x&&t.pos.x<o.size.x+o.pos.x&&t.pos.y+t.size.y>o.pos.y&&t.pos.y<o.size.y+o.pos.y)return o;break;case"circle":if(Math.pow(t.pos.x-o.pos.x,2)+Math.pow(t.pos.y-o.pos.y,2)<Math.pow(t.size.x/2+o.size.x/2,2))return o;break;case"polygon":for(var i=o.shapeOptions.points,r=!1,a={x:t.pos.x+.5,y:t.pos.y+.5},s=1;s<i.length-1;s++)if(w(a,.5*t.size.x,{x:o.pos.x+i[s-1][0],y:o.pos.y+i[s-1][1]},{x:o.pos.x+i[s][0],y:o.pos.y+i[s][1]})){r=!0;break}if(r)return o}}},oe.prototype.createSparkles=function(t){for(var e=t.count+Math.floor(Math.random()*(t.spread+1)),n=0;n<e;n++)this.effects.push(new mt({pos:new f(t.pos.x,t.pos.y),size:new f(.07+.07*Math.random(),.07+.07*Math.random()),speed:new f(.2*Math.random()-.1,.2*Math.random()-.1),color:t.color,strokeWidth:1,shape:u}))},oe.prototype.createActor=function(t){this.actors.push(t)},oe.prototype.destroyActor=function(t){this.actors=this.actors.filter((function(e){return e!==t}))};var ie=oe,re=document.querySelectorAll(".bg-image");function ae(t){this.level=t}ae.prototype.draw=function(t){this.drawBackground(t.ctx),this.drawActors(t.ctx),this.drawEffects(t.ctx)},ae.prototype.drawActors=function(t){var e=this;this.level.actors.forEach((function(n){switch(t.beginPath(),t.lineWidth="2",t.strokeStyle=n.color,n.shape){case"circle":t.globalAlpha=void 0!==n.alpha?n.alpha:1,t.arc((n.pos.x+.5)*e.level.cellSize,(n.pos.y+.5)*e.level.cellSize,.5*n.size.x*e.level.cellSize,0,2*Math.PI),t.stroke(),t.globalAlpha=1;break;case"square":t.rect(n.pos.x*e.level.cellSize,n.pos.y*e.level.cellSize,n.size.x*e.level.cellSize,n.size.x*e.level.cellSize),t.stroke();break;case"polygon":var o=n.shapeOptions.points;t.moveTo(n.pos.x*e.level.cellSize+o[0][0]*e.level.cellSize,n.pos.y*e.level.cellSize+o[0][1]*e.level.cellSize),o.slice(1).forEach((function(o){t.lineTo(n.pos.x*e.level.cellSize+o[0]*e.level.cellSize,n.pos.y*e.level.cellSize+o[1]*e.level.cellSize)})),t.stroke()}}))},ae.prototype.drawEffects=function(t){var e=this;this.level.effects.forEach((function(n){switch(t.beginPath(),t.lineWidth=n.options.strokeWidth||2,"stroke"===n.options.style?t.strokeStyle=n.color:t.fillStyle=n.color,n.shape){case"square":if("stroke"===n.options.style)t.rect(n.pos.x*e.level.cellSize,n.pos.y*e.level.cellSize,n.size.x*e.level.cellSize,n.size.y*e.level.cellSize),t.stroke();else{t.save(),t.globalAlpha=n.alpha;var o=n.pos.x*e.level.cellSize+n.size.x*e.level.cellSize/2,i=n.pos.y*e.level.cellSize+n.size.y*e.level.cellSize/2;t.translate(o,i),t.rotate(n.rotation*Math.PI/180),t.translate(-o,-i),t.fillRect(n.pos.x*e.level.cellSize,n.pos.y*e.level.cellSize,n.size.x*e.level.cellSize,n.size.y*e.level.cellSize),t.restore()}break;case"circle":t.globalAlpha=void 0!==n.alpha?n.alpha:1,t.arc((n.pos.x+.5)*e.level.cellSize,(n.pos.y+.5)*e.level.cellSize,.5*n.size.x*e.level.cellSize,0,2*Math.PI),t.stroke()}t.globalAlpha=1}))},ae.prototype.drawBackground=function(t){t.drawImage(re[this.level.levelIndex],0,0,1e3,600),t.beginPath(),t.fillStyle="#FF0000";var e=100*this.level.boss.hp/this.level.boss.maxHp/100;t.fillRect(0,0,this.level.screenWidth*this.level.cellSize*e,5),t.beginPath(),t.fillStyle="#6dd42c";var n=100*this.level.player.hp/this.level.player.maxHp/100;t.fillRect(0,this.level.screenHeight*this.level.cellSize-5,this.level.screenWidth*this.level.cellSize*n,this.level.screenHeight*this.level.cellSize)};var se=ae;function le(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}var ce=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,n,o;return e=t,(n=[{key:"create",value:function(t,e){this.level=new ie(t,t.maps[t.currentLevel],t.currentLevel,t.config,e),this.display=new se(this.level)}},{key:"update",value:function(t){this.level.animate(t)}},{key:"render",value:function(t){this.display.draw(t)}}])&&le(e.prototype,n),o&&le(e,o),t}();function ue(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}var pe={Digit1:{levelIndex:0,params:{text:"Призрак",color:"aqua"}},Digit2:{levelIndex:1,params:{text:"Иллюзионист",color:"#e91e63"}}},he=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,n,o;return e=t,(n=[{key:"create",value:function(t){this.initListeners(t)}},{key:"update",value:function(){}},{key:"initListeners",value:function(t){this.onKeyUp=this.onKeyUp.bind(this,t),addEventListener("keyup",this.onKeyUp)}},{key:"onKeyUp",value:function(t,e){if(void 0!==pe[e.code]){var n=pe[e.code];t.setCurrentLevel(n.levelIndex),t.config.development?t.changeState("game"):t.changeState("preview",n.params),this.removeListeners()}}},{key:"removeListeners",value:function(){removeEventListener("keyup",this.onKeyUp)}},{key:"render",value:function(t){var e=t.ctx;e.font="16px Arial",e.fillStyle="white",e.textAlign="center",e.fillText('Нажмите "1" чтобы сразиться с Призраком',t.canvas.width/2,t.canvas.height/2-20),e.fillText('Нажмите "2" чтобы сразиться с Иллюзионистом',t.canvas.width/2,t.canvas.height/2+20)}}])&&ue(e.prototype,n),o&&ue(e,o),t}();function fe(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}var ye=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.params=e}var e,n,o;return e=t,(n=[{key:"create",value:function(t,e){this.time=this.params.time||100,this.text=e.text||this.params.text||"Призрак",this.color=e.color||this.params.color,this.pause=50,this.state="fadeIn"}},{key:"update",value:function(t){switch(this.state){case"fadeIn":this.time>0?this.time-=1:this.state="pause";break;case"pause":this.pause>0?this.pause-=1:this.state="fadeOut";break;case"fadeOut":this.time<100?this.time+=1:(t.changeState("game",{boss:{color:this.color}}),t.ctx.globalAlpha=1)}}},{key:"render",value:function(t){var e=t.ctx;e.globalAlpha=(100-this.time)/100,e.font="18px Arial",e.fillStyle=this.color,e.textAlign="center",e.fillText(this.text,t.canvas.width/2,t.canvas.height/2)}}])&&fe(e.prototype,n),o&&fe(e,o),t}(),de=new i(document.querySelector("canvas"),[["                      ","                      ","  x                x  ","  x          B     x  ","  x                x  ","  xxxxx            x  ","      x            x  ","      x  x         x  ","             @     x  ","      xxxxxxxxxxxxxx  ","                      ","                      ","                      "],["                      ","                      ","  x                x  ","  x          B     x  ","  x                x  ","  xxxxx            x  ","      x            x  ","      x  x         x  ","             @     x  ","      xxxxxxxxxxxxxx  ","                      ","                      ","                      "]],{development:!1,debug:!1,scriptTime:!1});de.addState("menu",he),de.addState("preview",ye),de.addState("fail",ye,{text:"Вы проиграли",color:"white"}),de.addState("win",ye,{color:"white"}),de.addState("game",ce),de.runState("menu")}]);