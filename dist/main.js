!function(e){var t={};function o(n){if(t[n])return t[n].exports;var r=t[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,o),r.l=!0,r.exports}o.m=e,o.c=t,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)o.d(n,r,function(t){return e[t]}.bind(null,r));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="dist",o(o.s=4)}([function(e,t,o){var n=o(1),r=o(2);"string"==typeof(r=r.__esModule?r.default:r)&&(r=[[e.i,r,""]]);var i={insert:"head",singleton:!1},c=(n(r,i),r.locals?r.locals:{});e.exports=c},function(e,t,o){"use strict";var n,r=function(){return void 0===n&&(n=Boolean(window&&document&&document.all&&!window.atob)),n},i=function(){var e={};return function(t){if(void 0===e[t]){var o=document.querySelector(t);if(window.HTMLIFrameElement&&o instanceof window.HTMLIFrameElement)try{o=o.contentDocument.head}catch(e){o=null}e[t]=o}return e[t]}}(),c=[];function s(e){for(var t=-1,o=0;o<c.length;o++)if(c[o].identifier===e){t=o;break}return t}function l(e,t){for(var o={},n=[],r=0;r<e.length;r++){var i=e[r],l=t.base?i[0]+t.base:i[0],u=o[l]||0,a="".concat(l," ").concat(u);o[l]=u+1;var f=s(a),p={css:i[1],media:i[2],sourceMap:i[3]};-1!==f?(c[f].references++,c[f].updater(p)):c.push({identifier:a,updater:d(p,t),references:1}),n.push(a)}return n}function u(e){var t=document.createElement("style"),n=e.attributes||{};if(void 0===n.nonce){var r=o.nc;r&&(n.nonce=r)}if(Object.keys(n).forEach((function(e){t.setAttribute(e,n[e])})),"function"==typeof e.insert)e.insert(t);else{var c=i(e.insert||"head");if(!c)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");c.appendChild(t)}return t}var a,f=(a=[],function(e,t){return a[e]=t,a.filter(Boolean).join("\n")});function p(e,t,o,n){var r=o?"":n.media?"@media ".concat(n.media," {").concat(n.css,"}"):n.css;if(e.styleSheet)e.styleSheet.cssText=f(t,r);else{var i=document.createTextNode(r),c=e.childNodes;c[t]&&e.removeChild(c[t]),c.length?e.insertBefore(i,c[t]):e.appendChild(i)}}function h(e,t,o){var n=o.css,r=o.media,i=o.sourceMap;if(r?e.setAttribute("media",r):e.removeAttribute("media"),i&&btoa&&(n+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(i))))," */")),e.styleSheet)e.styleSheet.cssText=n;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(n))}}var y=null,b=0;function d(e,t){var o,n,r;if(t.singleton){var i=b++;o=y||(y=u(t)),n=p.bind(null,o,i,!1),r=p.bind(null,o,i,!0)}else o=u(t),n=h.bind(null,o,t),r=function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(o)};return n(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;n(e=t)}else r()}}e.exports=function(e,t){(t=t||{}).singleton||"boolean"==typeof t.singleton||(t.singleton=r());var o=l(e=e||[],t);return function(e){if(e=e||[],"[object Array]"===Object.prototype.toString.call(e)){for(var n=0;n<o.length;n++){var r=s(o[n]);c[r].references--}for(var i=l(e,t),u=0;u<o.length;u++){var a=s(o[u]);0===c[a].references&&(c[a].updater(),c.splice(a,1))}o=i}}}},function(e,t,o){(t=o(3)(!1)).push([e.i,"canvas {\r\n  background: black; }\r\n",""]),e.exports=t},function(e,t,o){"use strict";e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var o=function(e,t){var o=e[1]||"",n=e[3];if(!n)return o;if(t&&"function"==typeof btoa){var r=(c=n,s=btoa(unescape(encodeURIComponent(JSON.stringify(c)))),l="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(s),"/*# ".concat(l," */")),i=n.sources.map((function(e){return"/*# sourceURL=".concat(n.sourceRoot||"").concat(e," */")}));return[o].concat(i).concat([r]).join("\n")}var c,s,l;return[o].join("\n")}(t,e);return t[2]?"@media ".concat(t[2]," {").concat(o,"}"):o})).join("")},t.i=function(e,o,n){"string"==typeof e&&(e=[[null,e,""]]);var r={};if(n)for(var i=0;i<this.length;i++){var c=this[i][0];null!=c&&(r[c]=!0)}for(var s=0;s<e.length;s++){var l=[].concat(e[s]);n&&r[l[0]]||(o&&(l[2]?l[2]="".concat(o," and ").concat(l[2]):l[2]=o),t.push(l))}},t}},function(e,t,o){"use strict";o.r(t);o(0);var n="blue",r="red",i="yellow",c="aqua",s="white",l="square",u="circle",a="polygon";function f(e,t){this.x=e,this.y=t}f.prototype.add=function(e){return new f(this.x+e.x,this.y+e.y)},f.prototype.down=function(e){return new f(this.x-Math.sign(this.x)*e,this.y-Math.sign(this.y)*e)};var p=f;function h(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var y=function(){function e(t){var o=t.pos,r=t.speed,i=t.size,c=t.color,s=t.name,l=t.strokeWidth,u=t.style;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.pos=o,this.speed=r||new p(0,0),this.size=i||new p(1,1),this.color=c||n,this.name=s||"",this.options={strokeWidth:l||2,style:u||"stroke"}}var t,o,r;return t=e,(o=[{key:"act",value:function(e){var t=this;this.pos=this.pos.add(this.speed),(this.pos.x>e.screenWidth+3||this.pos.x<-3||this.pos.y<-3||this.pos.y>e.screenHeight+3)&&(e.actors=e.actors.filter((function(e){return e!==t})))}}])&&h(t.prototype,o),r&&h(t,r),e}();function b(e){return(b="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function d(e,t){return!t||"object"!==b(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function m(e){return(m=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function v(e,t){return(v=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var w=function(e){function t(e){var o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(o=d(this,m(t).call(this,e))).shape=u,o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&v(e,t)}(t,e),t}(y);function x(e){return(x="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function S(e,t){return!t||"object"!==x(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function g(e){return(g=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function O(e,t){return(O=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var _=function(e){function t(e){var o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(o=S(this,g(t).call(this,e))).shape=l,o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&O(e,t)}(t,e),t}(y);function z(e){return(z="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function j(e,t){return!t||"object"!==z(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function P(e){return(P=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function T(e,t){return(T=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var E=function(e){function t(e){var o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(o=j(this,P(t).call(this,e))).points=e.points||[[0,0],[40,40],[0,40],[0,0]],o.shape=a,o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&T(e,t)}(t,e),t}(y);function k(e){return(k="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function M(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function C(e,t){return!t||"object"!==k(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function R(e,t,o){return(R="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,o){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=H(e)););return e}(e,t);if(n){var r=Object.getOwnPropertyDescriptor(n,t);return r.get?r.get.call(o):r.value}})(e,t,o||e)}function H(e){return(H=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function A(e,t){return(A=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var W=function(e){function t(e){var o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(o=C(this,H(t).call(this,e))).savedSpeed=e.speed,o.speed=new p(0,0),o.timer=50,o.damage=1,o}var o,n,r;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&A(e,t)}(t,e),o=t,(n=[{key:"act",value:function(e){this.timer>0?(this.timer-=1,this.size=new p(this.size.x+.01,this.size.y+.01)):(R(H(t.prototype),"act",this).call(this,e),this.speed=this.savedSpeed)}}])&&M(o.prototype,n),r&&M(o,r),t}(w);function B(e){return(B="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function I(e,t){return!t||"object"!==B(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function q(e){return(q=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function L(e,t){return(L=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var N=function(e){function t(e){var o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(o=I(this,q(t).call(this,e))).damage=e.damage,o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&L(e,t)}(t,e),t}(w);function D(e,t){var o=e.x-t.x,n=e.y-t.y;return Math.atan2(n,o)}function F(e,t){return new p(Math.floor(Math.random()*(e+1)),Math.floor(Math.random()*(t+1)))}function U(e){return(U="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function J(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function X(e,t){return!t||"object"!==U(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Y(e){return(Y=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function G(e,t){return(G=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var K=function(e){function t(e){var o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(o=X(this,Y(t).call(this,e))).size=new p(.8,.8),o.speed=new p(.1,.1),o.shape=u,o.color=i,o.colors={initial:i,touched:n},o.maxHp=100,o.hp=o.maxHp,o.reloadTime=30,o.shootTime=0,o.bulletSpeed=.15,o}var o,r,l;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&G(e,t)}(t,e),o=t,(r=[{key:"act",value:function(e,t){var o=e.actorAt(this);o?"enemyBullet"===o.name&&(e.actors=e.actors.filter((function(e){return e!==o})),this.hp-=o.damage,e.createSparkles({count:7,spread:11,pos:o.pos,color:s})):this.color=this.colors.initial;var n=1;if((t.right&&t.down||t.right&&t.up||t.left&&t.down||t.left&&t.up)&&(n=.8),t.right&&this.pos.x<e.screenWidth-1&&(this.pos.x+=this.speed.x*n),t.left&&this.pos.x>0&&(this.pos.x-=this.speed.x*n),t.up&&this.pos.y>0&&(this.pos.y-=this.speed.y*n),t.down&&this.pos.y<e.screenHeight-1&&(this.pos.y+=this.speed.y*n),this.shootTime>0&&(this.shootTime-=1),t.mouseDown&&this.shootTime<=0){var r=D(new p(t.mouse.x/e.cellSize,t.mouse.y/e.cellSize),this.pos);e.createActor(new N({name:"playerBullet",pos:new p(this.pos.x,this.pos.y),speed:new p(this.bulletSpeed*Math.cos(r),this.bulletSpeed*Math.sin(r)),color:c,size:new p(.15,.15),damage:1})),this.shootTime=this.reloadTime}e.player={hp:this.hp,maxHp:this.maxHp}}}])&&J(o.prototype,r),l&&J(o,l),t}(y);function Q(e){return(Q="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function V(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Z(e,t){return!t||"object"!==Q(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function $(e){return($=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ee(e,t){return(ee=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var te=function(e){function t(e){var o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(o=Z(this,$(t).call(this,e))).shape=e.shape,o.maxTime=20,o.time=o.maxTime,o}var o,n,r;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ee(e,t)}(t,e),o=t,(n=[{key:"update",value:function(e){var t=this;this.time>0?(this.time-=1,this.speed=this.speed.down(.004)):e.effects=e.effects.filter((function(e){return e!==t}))}}])&&V(o.prototype,n),r&&V(o,r),t}(y);function oe(e){return(oe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ne(e,t){return!t||"object"!==oe(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function re(e){return(re=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ie(e,t){return(ie=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var ce=function(e){function t(e){var o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(o=ne(this,re(t).call(this,e))).shape=u,o.color=c,o.maxHp=100,o.hp=o.maxHp,o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ie(e,t)}(t,e),t}(y);function se(e){return(se="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function le(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function ue(e,t){return!t||"object"!==se(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function ae(e){return(ae=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function fe(e,t){return(fe=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var pe=function(e){function t(e){var o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(o=ue(this,ae(t).call(this,e))).shape=l,o.alpha=0,o.sign=0,o.rotation=e.rotation||0,o.startPos=o.pos,o}var o,n,r;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&fe(e,t)}(t,e),o=t,(n=[{key:"update",value:function(e){this.rotation+=4;var t=Math.sin(this.rotation/100);this.alpha=Math.abs(t);var o=Math.sign(t);this.size=new p(.16*this.alpha,.16*this.alpha),this.pos=new p(this.startPos.x-.08*this.alpha,this.startPos.y-.08*this.alpha),Math.sign(t)!==this.sign&&(this.startPos=F(e.screenWidth,e.screenHeight)),this.sign=o}}])&&le(o.prototype,n),r&&le(o,r),t}(y);function he(e){return(he="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ye(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function be(e,t){return!t||"object"!==he(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function de(e){return(de=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function me(e,t){return(me=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function ve(e){return(ve="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function we(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function xe(e,t){return!t||"object"!==ve(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Se(e){return(Se=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ge(e,t){return(ge=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Oe(e){return(Oe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var _e,ze,je,Pe,Te={x:"wall",o:"coin"},Ee={0:function(e){function t(e){var o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(o=be(this,de(t).call(this,e))).size=new p(2,2),o.reloadTime=50,o.shootTime=o.reloadTime,o.behaviourType=0,o}var o,n,r;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&me(e,t)}(t,e),o=t,(n=[{key:"act",value:function(e){if(this.shootTime>0)this.shootTime-=1;else{this.shootTime=this.reloadTime;var t=D(e.actors.filter((function(e){return e instanceof K}))[0].pos,this.pos);e.actors.push(new W({pos:new p(this.pos.x+1.9*Math.cos(t),this.pos.y+1.9*Math.sin(t)),speed:new p(.05*Math.cos(t),.05*Math.sin(t)),color:c,size:new p(.15,.15),name:"enemyBullet"}))}var o=e.actorAt(this);o&&"playerBullet"===o.name&&(e.actors=e.actors.filter((function(e){return e!==o})),this.hp-=o.damage,e.createSparkles({count:7,spread:11,pos:o.pos,color:s})),e.boss={hp:this.hp,maxHp:this.maxHp}}}])&&ye(o.prototype,n),r&&ye(o,r),t}(ce),1:function(e){function t(e){var o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(o=xe(this,Se(t).call(this,e))).size=new p(2,2),o.color=r,o}var o,n,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ge(e,t)}(t,e),o=t,(n=[{key:"act",value:function(){}}])&&we(o.prototype,n),i&&we(o,i),t}(ce)},ke={"@":function(e,t){return new K({pos:new p(e,t)})},s:function(e,t){return new _({pos:new p(e,t)})},c:function(e,t){return new w({pos:new p(e,t)})},p:function(e,t){return new E({pos:new p(e,t)})},B:function(e,t,o){return new Ee[o]({pos:new p(e,t)})}},Me=(_e={37:"left",38:"up",39:"right",40:"down"},ze={},je=function(e){_e.hasOwnProperty(e.keyCode)&&(ze[_e[e.keyCode]]="keydown"===e.type,e.preventDefault())},Pe=function(e){"mousedown"===e.type&&(ze.mouseDown=!0),"mouseup"===e.type&&(ze.mouseDown=!1),ze.mouse=new p(e.clientX-10,e.clientY-10)},addEventListener("keydown",je),addEventListener("keyup",je),document.onmousedown=Pe,document.onmouseup=Pe,document.onmousemove=Pe,ze);function Ce(e,t,o){this.cellSize=40,this.width=e[0].length,this.height=e.length,this.screenWidth=1e3/this.cellSize,this.screenHeight=600/this.cellSize,this.grid=[],this.actors=[],this.effects=[],this.levelIndex=t,this.config=o,this.player={},this.boss={};for(var n=0;n<this.height;n++){for(var r=[],i=0;i<this.width;i++){var c=e[n][i];ke[c]&&this.actors.push(ke[c](i,n,this.levelIndex)),r[i]=Te[c]||null}this.grid.push(r)}for(var l=0;l<20;l++)this.effects.push(new pe({pos:F(this.screenWidth,this.screenHeight),size:new p(0,0),color:s,strokeWidth:1,rotation:180*Math.random(),style:"fill"}))}Ce.prototype.animate=function(){this.config.debug&&(console.log("Actors count: ",this.actors.length),console.log(this.effects),console.log(Me)),this.updateActors()},Ce.prototype.updateActors=function(){var e=this;this.actors.forEach((function(t){t.act(e,Me)})),this.effects.forEach((function(t){t.act(e),t.update(e)}))},Ce.prototype.actorAt=function(e){for(var t=this,o=function(o){var n=t.actors[o];if(n!==e)switch(n.shape){case"square":if(e.pos.x+e.size.x>n.pos.x&&e.pos.x<n.size.x+n.pos.x&&e.pos.y+e.size.y>n.pos.y&&e.pos.y<n.size.y+n.pos.y)return{v:n};break;case"circle":if(Math.pow(e.pos.x-n.pos.x,2)+Math.pow(e.pos.y-n.pos.y,2)<Math.pow(e.size.x/2+n.size.x/2,2))return{v:n};break;case"polygon":for(var l=n.points,u=!1,a=0;a<n.points.length-1;a++){r=n.pos.x*t.cellSize+l[a][0],i=n.pos.y*t.cellSize+l[a][1],c=n.pos.x*t.cellSize+l[a+1][0],s=n.pos.y*t.cellSize+l[a+1][1];var f=e.pos.x*t.cellSize,p=e.pos.y*t.cellSize;[[f,p,f+e.size.x*t.cellSize,p],[f+e.size.x*t.cellSize,p,f+e.size.x*t.cellSize,p+e.size.y*t.cellSize],[f+e.size.x*t.cellSize,p+e.size.y*t.cellSize,f,p+e.size.y*t.cellSize],[f,p,f,p+e.size.y*t.cellSize]].forEach((function(o){var l=o[0],a=o[1],f=o[2],p=o[3];t.check(r,i,c,s,l,a,f,p,e,n)&&(u=!0)}))}if(u)return{v:n}}},n=0;n<this.actors.length;n++){var r,i,c,s,l=o(n);if("object"===Oe(l))return l.v}},Ce.prototype.check=function(e,t,o,n,r,i,c,s,l,u){var a=o-e,f=n-t,p=c-r,h=s-i,y=a*(i-t)-f*(r-e),b=a*(s-t)-f*(c-e),d=p*(n-i)-h*(o-r),m=p*(t-i)-h*(e-r),v=y*b<=0&&d*m<=0;return(y*b+d*m!=0||!(l.pos.x*this.cellSize+l.size.x*this.cellSize<u.pos.x*this.cellSize||l.pos.x*this.cellSize>u.pos.x*this.cellSize+u.size.x*this.cellSize))&&v},Ce.prototype.createSparkles=function(e){for(var t=e.count+Math.floor(Math.random()*(e.spread+1)),o=0;o<t;o++)this.effects.push(new te({pos:new p(e.pos.x,e.pos.y),size:new p(.07+.07*Math.random(),.07+.07*Math.random()),speed:new p(.2*Math.random()-.1,.2*Math.random()-.1),color:e.color,strokeWidth:1,shape:u}))},Ce.prototype.createActor=function(e){this.actors.push(e)};var Re=Ce,He=document.querySelector("canvas"),Ae=He.getContext("2d"),We=document.querySelector("#bg"),Be=He.width,Ie=He.height;function qe(e){this.level=e}qe.prototype.draw=function(){Ae.clearRect(0,0,Be,Ie),this.drawBackground(),this.drawActors(),this.drawEffects()},qe.prototype.drawActors=function(){var e=this;this.level.actors.forEach((function(t){switch(Ae.beginPath(),Ae.lineWidth="2",Ae.strokeStyle=t.color,t.shape){case"circle":Ae.arc((t.pos.x+.5)*e.level.cellSize,(t.pos.y+.5)*e.level.cellSize,.5*t.size.x*e.level.cellSize,0,2*Math.PI);break;case"square":Ae.rect(t.pos.x*e.level.cellSize,t.pos.y*e.level.cellSize,t.size.x*e.level.cellSize,t.size.x*e.level.cellSize);break;case"polygon":Ae.moveTo(t.pos.x*e.level.cellSize+t.points[0][0],t.pos.y*e.level.cellSize+t.points[0][1]),t.points.slice(1).forEach((function(o){Ae.lineTo(t.pos.x*e.level.cellSize+o[0],t.pos.y*e.level.cellSize+o[1])}))}Ae.stroke(),Ae.closePath()}))},qe.prototype.drawEffects=function(){var e=this;this.level.effects.forEach((function(t){switch(Ae.beginPath(),Ae.lineWidth=t.options.strokeWidth||2,"stroke"===t.options.style?Ae.strokeStyle=t.color:Ae.fillStyle=t.color,t.shape){case"square":if("stroke"===t.options.style)Ae.rect(t.pos.x*e.level.cellSize,t.pos.y*e.level.cellSize,t.size.x*e.level.cellSize,t.size.y*e.level.cellSize),Ae.stroke();else{Ae.save(),Ae.globalAlpha=t.alpha;var o=t.pos.x*e.level.cellSize+t.size.x*e.level.cellSize/2,n=t.pos.y*e.level.cellSize+t.size.y*e.level.cellSize/2;Ae.translate(o,n),Ae.rotate(t.rotation*Math.PI/180),Ae.translate(-o,-n),Ae.fillRect(t.pos.x*e.level.cellSize,t.pos.y*e.level.cellSize,t.size.x*e.level.cellSize,t.size.y*e.level.cellSize),Ae.restore()}break;case"circle":Ae.globalAlpha=t.time/t.maxTime,Ae.arc((t.pos.x+.5)*e.level.cellSize,(t.pos.y+.5)*e.level.cellSize,.5*t.size.x*e.level.cellSize,0,2*Math.PI),Ae.stroke()}Ae.globalAlpha=1}))},qe.prototype.drawBackground=function(){Ae.drawImage(We,0,0),Ae.beginPath(),Ae.fillStyle="#FF0000";var e=100*this.level.boss.hp/this.level.boss.maxHp/100;Ae.fillRect(0,0,this.level.screenWidth*this.level.cellSize*e,5),Ae.beginPath(),Ae.fillStyle="#6dd42c";var t=100*this.level.player.hp/this.level.player.maxHp/100;Ae.fillRect(0,this.level.screenHeight*this.level.cellSize-5,this.level.screenWidth*this.level.cellSize*t,this.level.screenHeight*this.level.cellSize)};var Le,Ne,De,Fe,Ue=qe,Je={debug:!1,scriptTime:!1};Fe=[["                      ","                      ","  x          B     x  ","  x                x  ","  x      @ xxxxx   x  ","  xxxxx            x  ","      x            x  ","      x  x         x  ","                   x  ","      xxxxxxxxxxxxxx  ","                      ","                      ","                      "],["                      ","                      ","  x                x  ","  x   o     o o    x  ","  x   c  @ xxxxx   x  ","  xxxxx    p       x  ","      x     s   B  x  ","      x  x    c    x  ","            p      x  ","      xxxxxxxxxxxxxx  ","                      ","                      ","                      "]][Le=0],Ne=new Re(Fe,Le,Je),De=new Ue(Ne),function e(){var t=performance.now();Ne.animate(),De.draw(),t=performance.now()-t,Je.scriptTime&&console.log("Время выполнения = ",t),window.requestAnimationFrame(e)}()}]);