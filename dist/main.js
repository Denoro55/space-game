!function(t){var e={};function n(o){if(e[o])return e[o].exports;var i=e[o]={i:o,l:!1,exports:{}};return t[o].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=t,n.c=e,n.d=function(t,e,o){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:o})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(o,i,function(e){return t[e]}.bind(null,i));return o},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="dist",n(n.s=4)}([function(t,e,n){var o=n(1),i=n(2);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[t.i,i,""]]);var r={insert:"head",singleton:!1},a=(o(i,r),i.locals?i.locals:{});t.exports=a},function(t,e,n){"use strict";var o,i=function(){return void 0===o&&(o=Boolean(window&&document&&document.all&&!window.atob)),o},r=function(){var t={};return function(e){if(void 0===t[e]){var n=document.querySelector(e);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(t){n=null}t[e]=n}return t[e]}}(),a=[];function s(t){for(var e=-1,n=0;n<a.length;n++)if(a[n].identifier===t){e=n;break}return e}function c(t,e){for(var n={},o=[],i=0;i<t.length;i++){var r=t[i],c=e.base?r[0]+e.base:r[0],l=n[c]||0,u="".concat(c," ").concat(l);n[c]=l+1;var p=s(u),h={css:r[1],media:r[2],sourceMap:r[3]};-1!==p?(a[p].references++,a[p].updater(h)):a.push({identifier:u,updater:m(h,e),references:1}),o.push(u)}return o}function l(t){var e=document.createElement("style"),o=t.attributes||{};if(void 0===o.nonce){var i=n.nc;i&&(o.nonce=i)}if(Object.keys(o).forEach((function(t){e.setAttribute(t,o[t])})),"function"==typeof t.insert)t.insert(e);else{var a=r(t.insert||"head");if(!a)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");a.appendChild(e)}return e}var u,p=(u=[],function(t,e){return u[t]=e,u.filter(Boolean).join("\n")});function h(t,e,n,o){var i=n?"":o.media?"@media ".concat(o.media," {").concat(o.css,"}"):o.css;if(t.styleSheet)t.styleSheet.cssText=p(e,i);else{var r=document.createTextNode(i),a=t.childNodes;a[e]&&t.removeChild(a[e]),a.length?t.insertBefore(r,a[e]):t.appendChild(r)}}function f(t,e,n){var o=n.css,i=n.media,r=n.sourceMap;if(i?t.setAttribute("media",i):t.removeAttribute("media"),r&&btoa&&(o+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(r))))," */")),t.styleSheet)t.styleSheet.cssText=o;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(o))}}var y=null,d=0;function m(t,e){var n,o,i;if(e.singleton){var r=d++;n=y||(y=l(e)),o=h.bind(null,n,r,!1),i=h.bind(null,n,r,!0)}else n=l(e),o=f.bind(null,n,e),i=function(){!function(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t)}(n)};return o(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap)return;o(t=e)}else i()}}t.exports=function(t,e){(e=e||{}).singleton||"boolean"==typeof e.singleton||(e.singleton=i());var n=c(t=t||[],e);return function(t){if(t=t||[],"[object Array]"===Object.prototype.toString.call(t)){for(var o=0;o<n.length;o++){var i=s(n[o]);a[i].references--}for(var r=c(t,e),l=0;l<n.length;l++){var u=s(n[l]);0===a[u].references&&(a[u].updater(),a.splice(u,1))}n=r}}}},function(t,e,n){(e=n(3)(!1)).push([t.i,"canvas {\r\n  background: black; }\r\n",""]),t.exports=e},function(t,e,n){"use strict";t.exports=function(t){var e=[];return e.toString=function(){return this.map((function(e){var n=function(t,e){var n=t[1]||"",o=t[3];if(!o)return n;if(e&&"function"==typeof btoa){var i=(a=o,s=btoa(unescape(encodeURIComponent(JSON.stringify(a)))),c="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(s),"/*# ".concat(c," */")),r=o.sources.map((function(t){return"/*# sourceURL=".concat(o.sourceRoot||"").concat(t," */")}));return[n].concat(r).concat([i]).join("\n")}var a,s,c;return[n].join("\n")}(e,t);return e[2]?"@media ".concat(e[2]," {").concat(n,"}"):n})).join("")},e.i=function(t,n,o){"string"==typeof t&&(t=[[null,t,""]]);var i={};if(o)for(var r=0;r<this.length;r++){var a=this[r][0];null!=a&&(i[a]=!0)}for(var s=0;s<t.length;s++){var c=[].concat(t[s]);o&&i[c[0]]||(n&&(c[2]?c[2]="".concat(n," and ").concat(c[2]):c[2]=n),e.push(c))}},e}},function(t,e,n){"use strict";n.r(e);n(0);function o(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}var i=function(){function t(e,n,o){var i=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.states={},this.activeState=null,this.canvas=e,this.ctx=this.canvas.getContext("2d"),this.gameWidth=this.canvas.width,this.gameHeight=this.canvas.height,this.maps=n,this.currentLevel=0,this.config=o,addEventListener("keyup",(function(t){83===t.keyCode&&"menu"===i.activeState&&(i.config.development?i.changeState("game"):i.changeState("preview"))}))}var e,n,i;return e=t,(n=[{key:"addState",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this.states[t]=new e(n)}},{key:"runState",value:function(t){this.activeState=t,this.run()}},{key:"changeState",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.activeState=t,this.states[this.activeState].create(this,e)}},{key:"run",value:function(){var t=this;!function e(){t.ctx.clearRect(0,0,t.gameWidth,t.gameHeight);var n=performance.now();t.states[t.activeState].update(t),t.states[t.activeState].render(t),n=performance.now()-n,t.config.scriptTime&&console.log("Время выполнения = ",n),window.requestAnimationFrame(e)}()}}])&&o(e.prototype,n),i&&o(e,i),t}(),r="#1b00ff",a="#fdb7b7",s="aqua",c="white",l="#00ff08",u="green",p="square",h="circle",f="polygon";function y(t,e){this.x=t,this.y=e}y.prototype.add=function(t){return new y(this.x+t.x,this.y+t.y)},y.prototype.down=function(t){return new y(this.x-Math.sign(this.x)*t,this.y-Math.sign(this.y)*t)};var d=y;function m(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}var b=function(){function t(e){var n=e.pos,o=e.speed,i=e.size,a=e.color,s=e.name,c=e.strokeWidth,l=e.style,u=e.alpha;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.pos=n,this.speed=o||new d(0,0),this.size=i||new d(1,1),this.color=a||r,this.name=s||"",this.alpha=void 0!==u?u:1,this.options={strokeWidth:c||2,style:l||"stroke"}}var e,n,o;return e=t,(n=[{key:"act",value:function(t){var e=this;if(this.pos=this.pos.add(this.speed),this.pos.x>t.screenWidth+3||this.pos.x<-3||this.pos.y<-3||this.pos.y>t.screenHeight+3){if("boss"===this.name)return;t.actors=t.actors.filter((function(t){return t!==e}))}}}])&&m(e.prototype,n),o&&m(e,o),t}();function v(t){return(v="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function w(t,e){return!e||"object"!==v(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function g(t){return(g=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function x(t,e){return(x=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var S=function(t){function e(t){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=w(this,g(e).call(this,t))).shape=h,n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&x(t,e)}(e,t),e}(b);function O(t){return(O="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function z(t,e){return!e||"object"!==O(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function P(t){return(P=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function k(t,e){return(k=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var j=function(t){function e(t){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=z(this,P(e).call(this,t))).shape=p,n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&k(t,e)}(e,t),e}(b);function T(t){return(T="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _(t,e){return!e||"object"!==T(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function M(t){return(M=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function E(t,e){return(E=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var A=function(t){function e(t){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=_(this,M(e).call(this,t))).points=t.points||[[0,0],[40,40],[0,40],[0,0]],n.shape=f,n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&E(t,e)}(e,t),e}(b);function W(t){return(W="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function C(t,e){return!e||"object"!==W(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function I(t){return(I=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function H(t,e){return(H=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var R=function(t){function e(t){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=C(this,I(e).call(this,t))).damage=t.damage,n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&H(t,e)}(e,t),e}(S);function B(t,e){var n=t.x-e.x,o=t.y-e.y;return Math.atan2(o,n)}function D(t,e){return new d(Math.floor(Math.random()*(t+1)),Math.floor(Math.random()*(e+1)))}function F(t){return t*Math.PI/180}function q(t){return(q="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function L(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function N(t,e){return!e||"object"!==q(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function U(t,e,n){return(U="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var o=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=J(t)););return t}(t,e);if(o){var i=Object.getOwnPropertyDescriptor(o,e);return i.get?i.get.call(n):i.value}})(t,e,n||t)}function J(t){return(J=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function V(t,e){return(V=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var X=function(t){function e(t){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=N(this,J(e).call(this,t))).damage=t.damage||1,n.states=t.states||[],n.activeStateIndex=0,n.currentStateIndex=null,n.angle=t.angle||0,n}var n,o,i;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&V(t,e)}(e,t),n=e,(o=[{key:"act",value:function(t){var n=this.states[this.activeStateIndex];U(J(e.prototype),"act",this).call(this,t),n&&(this.currentStateIndex!==this.activeStateIndex&&this.activateState(this.activeStateIndex,n,t),n.options&&(n.options.size&&this.size.x<n.options.size.maxSize&&(this.size=new d(this.size.x+n.options.size.value,this.size.y+n.options.size.value)),n.options.alpha&&this.alpha<n.options.alpha.target&&(this.alpha=Math.min(this.alpha+n.options.alpha.value,1))),void 0!==n.timer&&n.timer>0?n.timer-=1:this.activeStateIndex+=1)}},{key:"activateState",value:function(t,e,n){switch(this.currentStateIndex=t,e.type){case"changeDir":if(e.dir)this.angle=e.dir;else{var o,i=n.actors.filter((function(t){return t instanceof it}))[0];if(e.spreadAngle){var r=-e.spreadAngle+Math.random()*(2*e.spreadAngle);o=B(i.pos,this.pos)+F(r)}else o=B(i.pos,this.pos);this.angle=o}break;case"changeSpeed":this.speed=new d(e.speed*Math.cos(this.angle),e.speed*Math.sin(this.angle));break;case"stop":this.speed=new d(0,0);break;case"explode":n.destroyActor(this),n.createSparkles({count:7,spread:11,pos:this.pos,color:c});for(var a=60*Math.random(),l=0;l<6;l++){var u=F(60*l+a);n.actors.push(new X({pos:new d(this.pos.x,this.pos.y),speed:new d(.17*Math.cos(u),.17*Math.sin(u)),color:s,size:new d(.2,.2),name:"enemyBullet",damage:5}))}}}}])&&L(n.prototype,o),i&&L(n,i),e}(S);function Y(t){return(Y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function G(t,e){return!e||"object"!==Y(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function K(t){return(K=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Q(t,e){return(Q=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var Z=function(t){function e(t){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=G(this,K(e).call(this,t))).shape=h,n.color=s,n.maxHp=250,n.hp=n.maxHp,n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Q(t,e)}(e,t),e}(b);function $(t){return($="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function tt(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function et(t,e){return!e||"object"!==$(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function nt(t){return(nt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function ot(t,e){return(ot=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var it=function(t){function e(t){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=et(this,nt(e).call(this,t))).size=new d(.8,.8),n.speed=new d(.1,.1),n.shape=h,n.color=l,n.colors={initial:u,touched:r},n.maxHp=100,n.hp=n.maxHp,n.reloadTime=20,n.shootTime=0,n.bulletSpeed=.15,n}var n,o,i;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&ot(t,e)}(e,t),n=e,(o=[{key:"act",value:function(t,e){var n=t.actorAt(this);n?("enemyBullet"===n.name?(t.actors=t.actors.filter((function(t){return t!==n})),this.hp-=n.damage,t.createSparkles({count:7,spread:11,pos:n.pos,color:c})):n instanceof Z&&(this.hp-=n.damage),this.hp<=0&&t.fail()):this.color=this.colors.initial;var o=1;if((e.right&&e.down||e.right&&e.up||e.left&&e.down||e.left&&e.up)&&(o=.8),e.right&&this.pos.x<t.screenWidth-1&&(this.pos.x+=this.speed.x*o),e.left&&this.pos.x>0&&(this.pos.x-=this.speed.x*o),e.up&&this.pos.y>0&&(this.pos.y-=this.speed.y*o),e.down&&this.pos.y<t.screenHeight-1&&(this.pos.y+=this.speed.y*o),this.shootTime>0&&(this.shootTime-=1),e.mouseDown&&this.shootTime<=0){var i=B(new d(e.mouse.x/t.cellSize,e.mouse.y/t.cellSize),this.pos);t.createActor(new R({name:"playerBullet",pos:new d(this.pos.x,this.pos.y),speed:new d(this.bulletSpeed*Math.cos(i),this.bulletSpeed*Math.sin(i)),color:u,size:new d(.15,.15),damage:1})),this.shootTime=this.reloadTime}t.player={hp:this.hp,maxHp:this.maxHp}}}])&&tt(n.prototype,o),i&&tt(n,i),e}(b);function rt(t){return(rt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function at(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function st(t,e){return!e||"object"!==rt(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function ct(t){return(ct=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function lt(t,e){return(lt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var ut=function(t){function e(t){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=st(this,ct(e).call(this,t))).shape=t.shape,n.maxTime=20,n.time=n.maxTime,n}var n,o,i;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&lt(t,e)}(e,t),n=e,(o=[{key:"update",value:function(t){var e=this;this.time>0?(this.time-=1,this.speed=this.speed.down(.004),this.alpha=this.time/this.maxTime):t.effects=t.effects.filter((function(t){return t!==e}))}}])&&at(n.prototype,o),i&&at(n,i),e}(b);function pt(t){return(pt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ht(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function ft(t,e){return!e||"object"!==pt(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function yt(t){return(yt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function dt(t,e){return(dt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var mt=function(t){function e(t){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=ft(this,yt(e).call(this,t))).shape=p,n.alpha=0,n.sign=0,n.rotation=t.rotation||0,n.startPos=n.pos,n.delay=t.delay,n}var n,o,i;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&dt(t,e)}(e,t),n=e,(o=[{key:"update",value:function(t){if(this.delay>0)this.delay-=1;else{this.rotation+=4;var e=Math.sin(this.rotation/100);this.alpha=Math.abs(e);var n=Math.sign(e);this.size=new d(.16*this.alpha,.16*this.alpha),this.pos=new d(this.startPos.x-.08*this.alpha,this.startPos.y-.08*this.alpha),Math.sign(e)!==this.sign&&(this.startPos=D(t.screenWidth,t.screenHeight)),this.sign=n}}}])&&ht(n.prototype,o),i&&ht(n,i),e}(b);function bt(t){return(bt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function vt(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function wt(t,e){return!e||"object"!==bt(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function gt(t){return(gt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function xt(t,e){return(xt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var St=function(t){function e(t){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=wt(this,gt(e).call(this,t))).shape=t.shape||h,n.updateFunc=t.updateFunc||null,n.alphaTransitionSpeed=.007,n.alive=!0,n.reloadTime=30,n.time=n.reloadTime,n.activeWeapon=t.type||0,n.currentWeapon=null,n.appearedTimer=100,n}var n,o,i;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&xt(t,e)}(e,t),n=e,(o=[{key:"update",value:function(t){var e=this;if(this.updateFunc&&this.updateFunc(),this.activeWeapon!==this.currentWeapon&&this.activateWeapon(this.activeWeapon),this.alive)if(this.appearedTimer>0)this.appearedTimer-=1;else if(this.time>0)this.time-=1;else{switch(this.activeWeapon){case 0:t.createActor(new X({pos:new d(this.pos.x,this.pos.y),color:s,size:new d(.4,.4),name:"enemyBullet",damage:30,alpha:.1,states:[{type:"changeDir"},{type:"changeSpeed",speed:.15},{type:"waiting",timer:30+35*Math.random(),options:{size:{value:.01,maxSize:1},alpha:{value:.02,target:1}}},{type:"stop",timer:25},{type:"explode"}]}));break;case 1:t.createActor(new X({pos:new d(this.pos.x,this.pos.y),color:s,size:new d(.3,.3),name:"enemyBullet",damage:10,alpha:.1,states:[{type:"changeDir",spreadAngle:38},{type:"changeSpeed",speed:.2},{type:"waiting",timer:50,options:{alpha:{value:.02,target:1}}}]}))}this.time=this.reloadTime}else this.alpha=Math.max(this.alpha-this.alphaTransitionSpeed,0),this.alpha<=0&&(t.effects=t.effects.filter((function(t){return t!==e})))}},{key:"activateWeapon",value:function(t){switch(this.currentWeapon=t,t){case 0:this.reloadTime=30,this.time=this.reloadTime;break;case 1:this.reloadTime=10,this.time=this.reloadTime}}},{key:"updateAlpha",value:function(t){this.alpha<t&&(this.alpha+=.004),this.alpha>t&&(this.alpha=t)}},{key:"destroy",value:function(){this.alive=!1}}])&&vt(n.prototype,o),i&&vt(n,i),e}(b);function Ot(t){return(Ot="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function zt(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function Pt(t,e){return!e||"object"!==Ot(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function kt(t,e,n){return(kt="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var o=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=jt(t)););return t}(t,e);if(o){var i=Object.getOwnPropertyDescriptor(o,e);return i.get?i.get.call(n):i.value}})(t,e,n||t)}function jt(t){return(jt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Tt(t,e){return(Tt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function _t(t){return(_t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Mt(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function Et(t,e){return!e||"object"!==_t(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function At(t){return(At=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Wt(t,e){return(Wt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Ct(t){return(Ct="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var It,Ht,Rt,Bt,Dt={x:"wall",o:"coin"},Ft={0:function(t){function e(t){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=Pt(this,jt(e).call(this,t))).name="boss",n.size=new d(2,2),n.damage=1,n.reloadTime=35,n.shootTime=n.reloadTime,n.states=[{bullets:0,nextState:[0,1,2,4]},{bullets:0,bulletPositions:[],nextState:[0,1,2,4]},{stopTime:200,nextState:[3,3,3,4]},{pointPosition:new d(0,0),nextState:[0,1]},{pointPosition:new d(0,0),timer:-1,startTimer:15,waves:15,nextState:[0,1,2]}],n.activeStateIndex=0,n.currentStateIndex=null,n.weapons={left:{active:!1,type:0,weapon:null},right:{active:!1,type:0,weapon:null}},n.bulletOptions={offset:1.9,speed:.12,damage:10},n.delay=0,n.alpha=1,n.alphaTransitionSpeed=.004,n.maxSpeed=.06,n.visibility=!0,n}var n,o,i;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Tt(t,e)}(e,t),n=e,(o=[{key:"act",value:function(t){this.activeStateIndex!==this.currentStateIndex&&this.activateState(this.activeStateIndex,t);var n=this.states[this.activeStateIndex];if(this.changeAlpha(this.visibility),this.delay>0)this.delay-=1;else switch(this.shootTime>0&&(this.shootTime-=1),this.activeStateIndex){case 0:if(this.shootTime<=0){this.shootTime=this.reloadTime;var o=B(t.actors.filter((function(t){return t instanceof it}))[0].pos,this.pos);t.actors.push(new X({pos:new d(this.pos.x+this.bulletOptions.offset*Math.cos(o),this.pos.y+this.bulletOptions.offset*Math.sin(o)),color:s,size:new d(.15,.15),name:"enemyBullet",alpha:.1,damage:this.bulletOptions.damage,angle:o,states:[{type:"stop",timer:45,options:{size:{value:.01,maxSize:.7},alpha:{value:.03,target:1}}},{type:"changeDir",target:"player"},{type:"changeSpeed",speed:this.bulletOptions.speed}]})),n.bullets-=1}n.bullets<=0&&this.nextState(t);break;case 1:if(this.shootTime<=0&&n.bulletPositions.length>0){var i=45*n.bulletPositions.shift()*Math.PI/180;t.actors.push(new X({pos:new d(this.pos.x+this.bulletOptions.offset*Math.cos(i),this.pos.y+this.bulletOptions.offset*Math.sin(i)),color:s,size:new d(.15,.15),name:"enemyBullet",damage:this.bulletOptions.damage,states:[{type:"stopped",timer:50,options:{size:{value:.01,maxSize:.7}}},{type:"changeDir",target:"player",spreadAngle:50},{type:"changeSpeed",speed:this.bulletOptions.speed}]})),this.shootTime=this.reloadTime}n.bulletPositions.length<=0&&this.nextState(t);break;case 2:kt(jt(e.prototype),"act",this).call(this,t);var r=t.actors.filter((function(t){return t instanceof it}))[0];this.moveToPoint(r.pos),this.shootTime<=0&&(this.makeFloatingBullet(t),this.shootTime=this.reloadTime),n.stopTime>0?n.stopTime-=1:this.nextState(t);break;case 3:kt(jt(e.prototype),"act",this).call(this,t),this.moveToPoint(n.pointPosition),this.shootTime<=0&&(this.makeFloatingBullet(t),this.shootTime=this.reloadTime),Math.sqrt(Math.pow(this.pos.x-n.pointPosition.x,2)+Math.pow(this.pos.y-n.pointPosition.y,2))<35*this.maxSpeed&&this.nextState(t);break;case 4:if(kt(jt(e.prototype),"act",this).call(this,t),this.moveToPoint(n.pointPosition),Math.sqrt(Math.pow(this.pos.x-n.pointPosition.x,2)+Math.pow(this.pos.y-n.pointPosition.y,2))<35*this.maxSpeed)if(this.speed=new d(0,0),n.timer<0){n.timer=n.startTimer;var a=this.getPercentHealth()<50?12:8;n.bulletPositions=this.fillBullets(a),this.makeWave(n,t),n.waves-=1}else n.timer-=1;n.waves<=0&&this.nextState(t)}var l=t.actorAt(this,{name:"playerBullet"});l&&(t.actors=t.actors.filter((function(t){return t!==l})),this.hp-=l.damage,t.createSparkles({count:7,spread:11,pos:l.pos,color:c}),this.hp<=0&&t.win({text:"Вы победили призрака!"})),t.boss={hp:this.hp,maxHp:this.maxHp}}},{key:"makeWave",value:function(t,e){var n,o,i=30*Math.random();this.getPercentHealth()<50?(n=12,o=30):(n=8,o=45);for(var r=0;r<n;r++){var a=(i+t.bulletPositions.shift()*o)*Math.PI/180;e.actors.push(new X({pos:new d(this.pos.x+this.bulletOptions.offset*Math.cos(a),this.pos.y+this.bulletOptions.offset*Math.sin(a)),color:s,size:new d(.2,.2),name:"enemyBullet",alpha:.1,damage:this.bulletOptions.damage,states:[{type:"stopped",timer:25,options:{size:{value:.01,maxSize:.7},alpha:{value:.04,target:1}}},{type:"changeDir",dir:a},{type:"changeSpeed",speed:this.bulletOptions.speed}]}))}}},{key:"makeFloatingBullet",value:function(t){t.actors.push(new X({pos:new d(this.pos.x,this.pos.y),color:s,size:new d(.15,.15),name:"enemyBullet",damage:this.bulletOptions.damage,states:[{type:"stopped",timer:150+500*Math.random(),options:{size:{value:.01,maxSize:.7}}},{type:"changeDir",target:"player",spreadAngle:25},{type:"changeSpeed",speed:this.bulletOptions.speed}]}))}},{key:"moveToPoint",value:function(t){this.pos.x<t.x?this.speed=new d(Math.min(this.speed.x+.002,this.maxSpeed),this.speed.y):this.pos.x>t.x&&(this.speed=new d(Math.max(this.speed.x-.002,-this.maxSpeed),this.speed.y)),this.pos.y<t.y?this.speed=new d(this.speed.x,Math.min(this.speed.y+.002,this.maxSpeed)):this.pos.y>t.y&&(this.speed=new d(this.speed.x,Math.max(this.speed.y-.002,-this.maxSpeed)))}},{key:"fillBullets",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:8,e=[],n=0;n<t;n++)e.push(n);return e.sort((function(){return Math.random()-.5}))}},{key:"nextState",value:function(t){var e=this.states[this.activeStateIndex],n=Math.floor(Math.random()*e.nextState.length);this.activateState(e.nextState[n],t)}},{key:"getCoordsWeapon",value:function(t,e){var n="left"===t?-90:90,o=F(function(t){return t/Math.PI*180}(B(e.actors.filter((function(t){return t instanceof it}))[0].pos,this.pos))+n);return new d(this.pos.x+this.bulletOptions.offset*Math.cos(o),this.pos.y+this.bulletOptions.offset*Math.sin(o))}},{key:"getAlpha",value:function(){return this.alpha}},{key:"activateWeapon",value:function(t,e){if(!this.weapons[t].active){var n=this,o=new St({pos:new d(this.pos.x,this.pos.y),color:s,size:new d(.7,.7),alpha:0,shape:h,type:Math.floor(2*Math.random()),updateFunc:function(){this.pos=n.getCoordsWeapon(t,e),this.updateAlpha(n.getAlpha())}});this.weapons[t].active=!0,this.weapons[t].weapon=o,e.effects.push(o)}}},{key:"disableWeapon",value:function(t){this.weapons[t].active&&(this.weapons[t].active=!1,this.weapons[t].weapon.destroy())}},{key:"changeAlpha",value:function(t){this.alpha=t?Math.min(this.alpha+this.alphaTransitionSpeed,1):Math.max(this.alpha-this.alphaTransitionSpeed,0)}},{key:"randomizeVisibility",value:function(){this.visibility=Math.random()<.5}},{key:"getPercentHealth",value:function(){return 100*this.hp/this.maxHp}},{key:"activateState",value:function(t,e){this.activeStateIndex=t,this.currentStateIndex=t;var n=this.states[t],o=this.getPercentHealth();switch(this.disableWeapon("left",e),this.disableWeapon("right",e),this.randomizeVisibility(),o<50&&(this.maxSpeed=.09),t){case 0:n.bullets=o<50?8+6*Math.random():4+6*Math.random(),this.delay=50,this.reloadTime=35,Math.random()<1-o/100+.4&&this.activateWeapon("left",e),Math.random()<1-o/100+.4&&this.activateWeapon("right",e);break;case 1:n.bulletPositions=this.fillBullets(),this.reloadTime=10,this.delay=50,this.shootTime=this.reloadTime;break;case 2:var i=B(e.actors.filter((function(t){return t instanceof it}))[0].pos,this.pos);this.speed=new d(.03*Math.cos(i),.03*Math.sin(i)),this.shootTime=this.reloadTime,n.stopTime=400,this.visibility=!1,o>50?this.reloadTime=40:o<=50&&o>25?(this.reloadTime=25,Math.random()<.5&&this.activateWeapon("right",e)):(this.reloadTime=25,Math.random()<.5&&this.activateWeapon("right",e),Math.random()<.5&&this.activateWeapon("left",e));break;case 3:var r=D(e.screenWidth-6,e.screenHeight-6);n.pointPosition=new d(3+r.x,3+r.y);break;case 4:n.pointPosition=new d(e.screenWidth/2,e.screenHeight/2),n.waves=Math.floor(15+10*Math.random())}}}])&&zt(n.prototype,o),i&&zt(n,i),e}(Z),1:function(t){function e(t){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=Et(this,At(e).call(this,t))).size=new d(2,2),n.color=a,n}var n,o,i;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Wt(t,e)}(e,t),n=e,(o=[{key:"act",value:function(){}}])&&Mt(n.prototype,o),i&&Mt(n,i),e}(Z)},qt={"@":function(t,e){return new it({pos:new d(t,e)})},s:function(t,e){return new j({pos:new d(t,e)})},c:function(t,e){return new S({pos:new d(t,e)})},p:function(t,e){return new A({pos:new d(t,e)})},B:function(t,e,n){return new Ft[n]({pos:new d(t,e)})}},Lt=(It={37:"left",38:"up",39:"right",40:"down",87:"up",68:"right",65:"left",83:"down"},Ht={},Rt=function(t){It.hasOwnProperty(t.keyCode)&&(Ht[It[t.keyCode]]="keydown"===t.type,t.preventDefault())},Bt=function(t){"mousedown"===t.type&&(Ht.mouseDown=!0),"mouseup"===t.type&&(Ht.mouseDown=!1),Ht.mouse=new d(t.clientX-10,t.clientY-10)},addEventListener("keydown",Rt),addEventListener("keyup",Rt),document.onmousedown=Bt,document.onmouseup=Bt,document.onmousemove=Bt,Ht);function Nt(t,e,n,o){this.game=t,this.cellSize=40,this.width=e[0].length,this.height=e.length,this.screenWidth=1e3/this.cellSize,this.screenHeight=600/this.cellSize,this.grid=[],this.actors=[],this.effects=[],this.levelIndex=n,this.config=o,this.player={},this.boss={};for(var i=0;i<this.height;i++){for(var r=[],a=0;a<this.width;a++){var s=e[i][a];qt[s]&&this.actors.push(qt[s](a,i,this.levelIndex)),r[a]=Dt[s]||null}this.grid.push(r)}for(var l=0;l<20;l++)this.effects.push(new mt({pos:D(this.screenWidth,this.screenHeight),size:new d(0,0),color:c,strokeWidth:1,rotation:0,delay:60*Math.random(),style:"fill"}))}Nt.prototype.animate=function(){this.config.debug&&console.log("Actors count: ",this.actors.length,"| Effects count: ",this.effects.length),this.updateActors()},Nt.prototype.fail=function(){this.game.changeState("fail")},Nt.prototype.win=function(t){this.game.changeState("win",t)},Nt.prototype.updateActors=function(){var t=this;this.actors.forEach((function(e){e.act(t,Lt)})),this.effects.forEach((function(e){e.act(t),e.update(t)}))},Nt.prototype.actorAt=function(t,e){for(var n=this,o=function(o){var i=n.actors[o];if(e&&e.name!==i.name)return"continue";if(i!==t)switch(i.shape){case"square":if(t.pos.x+t.size.x>i.pos.x&&t.pos.x<i.size.x+i.pos.x&&t.pos.y+t.size.y>i.pos.y&&t.pos.y<i.size.y+i.pos.y)return{v:i};break;case"circle":if(Math.pow(t.pos.x-i.pos.x,2)+Math.pow(t.pos.y-i.pos.y,2)<Math.pow(t.size.x/2+i.size.x/2,2))return{v:i};break;case"polygon":for(var l=i.points,u=!1,p=0;p<i.points.length-1;p++){r=i.pos.x*n.cellSize+l[p][0],a=i.pos.y*n.cellSize+l[p][1],s=i.pos.x*n.cellSize+l[p+1][0],c=i.pos.y*n.cellSize+l[p+1][1];var h=t.pos.x*n.cellSize,f=t.pos.y*n.cellSize;[[h,f,h+t.size.x*n.cellSize,f],[h+t.size.x*n.cellSize,f,h+t.size.x*n.cellSize,f+t.size.y*n.cellSize],[h+t.size.x*n.cellSize,f+t.size.y*n.cellSize,h,f+t.size.y*n.cellSize],[h,f,h,f+t.size.y*n.cellSize]].forEach((function(e){var o=e[0],l=e[1],p=e[2],h=e[3];n.check(r,a,s,c,o,l,p,h,t,i)&&(u=!0)}))}if(u)return{v:i}}},i=0;i<this.actors.length;i++){var r,a,s,c,l=o(i);switch(l){case"continue":continue;default:if("object"===Ct(l))return l.v}}},Nt.prototype.check=function(t,e,n,o,i,r,a,s,c,l){var u=n-t,p=o-e,h=a-i,f=s-r,y=u*(r-e)-p*(i-t),d=u*(s-e)-p*(a-t),m=h*(o-r)-f*(n-i),b=h*(e-r)-f*(t-i),v=y*d<=0&&m*b<=0;return(y*d+m*b!=0||!(c.pos.x*this.cellSize+c.size.x*this.cellSize<l.pos.x*this.cellSize||c.pos.x*this.cellSize>l.pos.x*this.cellSize+l.size.x*this.cellSize))&&v},Nt.prototype.createSparkles=function(t){for(var e=t.count+Math.floor(Math.random()*(t.spread+1)),n=0;n<e;n++)this.effects.push(new ut({pos:new d(t.pos.x,t.pos.y),size:new d(.07+.07*Math.random(),.07+.07*Math.random()),speed:new d(.2*Math.random()-.1,.2*Math.random()-.1),color:t.color,strokeWidth:1,shape:h}))},Nt.prototype.createActor=function(t){this.actors.push(t)},Nt.prototype.destroyActor=function(t){this.actors=this.actors.filter((function(e){return e!==t}))};var Ut=Nt,Jt=document.querySelector("#bg");function Vt(t){this.level=t}Vt.prototype.draw=function(t){this.drawBackground(t.ctx),this.drawActors(t.ctx),this.drawEffects(t.ctx)},Vt.prototype.drawActors=function(t){var e=this;this.level.actors.forEach((function(n){switch(t.beginPath(),t.lineWidth="2",t.strokeStyle=n.color,n.shape){case"circle":t.globalAlpha=void 0!==n.alpha?n.alpha:1,t.arc((n.pos.x+.5)*e.level.cellSize,(n.pos.y+.5)*e.level.cellSize,.5*n.size.x*e.level.cellSize,0,2*Math.PI),t.stroke(),t.globalAlpha=1;break;case"square":t.rect(n.pos.x*e.level.cellSize,n.pos.y*e.level.cellSize,n.size.x*e.level.cellSize,n.size.x*e.level.cellSize),t.stroke();break;case"polygon":t.moveTo(n.pos.x*e.level.cellSize+n.points[0][0],n.pos.y*e.level.cellSize+n.points[0][1]),n.points.slice(1).forEach((function(o){t.lineTo(n.pos.x*e.level.cellSize+o[0],n.pos.y*e.level.cellSize+o[1])})),t.stroke()}}))},Vt.prototype.drawEffects=function(t){var e=this;this.level.effects.forEach((function(n){switch(t.beginPath(),t.lineWidth=n.options.strokeWidth||2,"stroke"===n.options.style?t.strokeStyle=n.color:t.fillStyle=n.color,n.shape){case"square":if("stroke"===n.options.style)t.rect(n.pos.x*e.level.cellSize,n.pos.y*e.level.cellSize,n.size.x*e.level.cellSize,n.size.y*e.level.cellSize),t.stroke();else{t.save(),t.globalAlpha=n.alpha;var o=n.pos.x*e.level.cellSize+n.size.x*e.level.cellSize/2,i=n.pos.y*e.level.cellSize+n.size.y*e.level.cellSize/2;t.translate(o,i),t.rotate(n.rotation*Math.PI/180),t.translate(-o,-i),t.fillRect(n.pos.x*e.level.cellSize,n.pos.y*e.level.cellSize,n.size.x*e.level.cellSize,n.size.y*e.level.cellSize),t.restore()}break;case"circle":t.globalAlpha=void 0!==n.alpha?n.alpha:1,t.arc((n.pos.x+.5)*e.level.cellSize,(n.pos.y+.5)*e.level.cellSize,.5*n.size.x*e.level.cellSize,0,2*Math.PI),t.stroke()}t.globalAlpha=1}))},Vt.prototype.drawBackground=function(t){t.drawImage(Jt,0,0),t.beginPath(),t.fillStyle="#FF0000";var e=100*this.level.boss.hp/this.level.boss.maxHp/100;t.fillRect(0,0,this.level.screenWidth*this.level.cellSize*e,5),t.beginPath(),t.fillStyle="#6dd42c";var n=100*this.level.player.hp/this.level.player.maxHp/100;t.fillRect(0,this.level.screenHeight*this.level.cellSize-5,this.level.screenWidth*this.level.cellSize*n,this.level.screenHeight*this.level.cellSize)};var Xt=Vt;function Yt(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}var Gt=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,n,o;return e=t,(n=[{key:"create",value:function(t){this.level=new Ut(t,t.maps[t.currentLevel],t.currentLevel,t.config),this.display=new Xt(this.level)}},{key:"update",value:function(t){this.level.animate(t)}},{key:"render",value:function(t){this.display.draw(t)}}])&&Yt(e.prototype,n),o&&Yt(e,o),t}();function Kt(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}var Qt=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,n,o;return e=t,(n=[{key:"update",value:function(){}},{key:"render",value:function(t){var e=t.ctx;e.font="18px Arial",e.fillStyle="white",e.textAlign="center",e.fillText('Нажмите "S", чтобы начать игру.',t.canvas.width/2,t.canvas.height/2)}}])&&Kt(e.prototype,n),o&&Kt(e,o),t}();function Zt(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}var $t=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.params=e}var e,n,o;return e=t,(n=[{key:"create",value:function(t,e){this.time=this.params.time||100,this.text=e.text||this.params.text||"Призрак",this.color=this.params.color||"aqua",this.pause=50,this.state="fadeIn"}},{key:"update",value:function(t){switch(this.state){case"fadeIn":this.time>0?this.time-=1:this.state="pause";break;case"pause":this.pause>0?this.pause-=1:this.state="fadeOut";break;case"fadeOut":this.time<100?this.time+=1:(t.changeState("game"),t.ctx.globalAlpha=1)}}},{key:"render",value:function(t){var e=t.ctx;e.globalAlpha=(100-this.time)/100,e.font="18px Arial",e.fillStyle=this.color,e.textAlign="center",e.fillText(this.text,t.canvas.width/2,t.canvas.height/2)}}])&&Zt(e.prototype,n),o&&Zt(e,o),t}(),te=new i(document.querySelector("canvas"),[["                      ","                      ","  x                x  ","  x          B     x  ","  x                x  ","  xxxxx            x  ","      x            x  ","      x  x         x  ","             @     x  ","      xxxxxxxxxxxxxx  ","                      ","                      ","                      "],["                      ","                      ","  x                x  ","  x   o     o o    x  ","  x   c    xxxxx   x  ","  xxxxx    p       x  ","      x     s   B  x  ","      x  x    c    x  ","            p      x  ","      xxxxxxxxxxxxxx  ","                      ","                      ","                      "]],{development:!1,debug:!1,scriptTime:!1});te.addState("menu",Qt),te.addState("preview",$t),te.addState("fail",$t,{text:"Вы проиграли",color:"white"}),te.addState("win",$t,{color:"white"}),te.addState("game",Gt),te.runState("menu")}]);